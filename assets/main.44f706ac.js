(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();class Mt{constructor(){var e;this.tg=(e=window.Telegram)==null?void 0:e.WebApp,this.isInitialized=!1,this.user=null,this.tonConnect=null,this.init()}init(){var e;if(this.tg&&((e=this.tg.initDataUnsafe)!=null&&e.user))this.tg.ready(),this.tg.expand(),this.user=this.tg.initDataUnsafe.user,this.isInitialized=!0,console.log("‚úì Telegram SDK initialized with real user:",this.user);else{console.warn("‚ö†Ô∏è Telegram WebApp user not available - using test user");const s=new URLSearchParams(window.location.search).get("id"),i=s?parseInt(s):123456789;this.user={id:i,first_name:"Test",last_name:"User",username:"testuser",photo_url:null},this.isInitialized=!0,console.log("‚úì Test user created with ID:",i,this.user)}}getUser(){return this.user}getUserName(){return this.user?this.user.username?"@"+this.user.username:this.user.first_name+(this.user.last_name?" "+this.user.last_name:""):"–ì–æ—Å—Ç—å"}getUserPhoto(){var e;return((e=this.user)==null?void 0:e.photo_url)||null}getUserId(){var t;const e=((t=this.user)==null?void 0:t.id)||null;return console.log("Getting user ID:",e),e}getReferralCode(){const e=new URLSearchParams(window.location.search);return e.get("ref")||e.get("start")}createReferralLink(e){return`https://t.me/ClickerCosmoBot?start=${e}`}sendData(e){this.tg&&this.tg.sendData(JSON.stringify(e))}showMainButton(e,t){this.tg&&(this.tg.MainButton.text=e,this.tg.MainButton.show(),this.tg.MainButton.onClick(t))}hideMainButton(){this.tg&&this.tg.MainButton.hide()}showAlert(e){this.tg?this.tg.showAlert(e):alert(e)}showConfirm(e,t){if(this.tg)this.tg.showConfirm(e,t);else{const s=confirm(e);t(s)}}hapticFeedback(e="impact",t="medium"){var s;(s=this.tg)!=null&&s.HapticFeedback&&(e==="impact"?this.tg.HapticFeedback.impactOccurred(t):e==="notification"?this.tg.HapticFeedback.notificationOccurred(t):e==="selection"&&this.tg.HapticFeedback.selectionChanged())}getStartParam(){var s,i;if(console.log("üîç –ü–æ–ª—É—á–∞–µ–º start –ø–∞—Ä–∞–º–µ—Ç—Ä..."),(i=(s=this.tg)==null?void 0:s.initDataUnsafe)!=null&&i.start_param)return console.log("‚úÖ Start –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–∑ Telegram:",this.tg.initDataUnsafe.start_param),this.tg.initDataUnsafe.start_param;const e=new URLSearchParams(window.location.search),t=e.get("start")||e.get("ref");return console.log("üåê Start –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–∑ URL:",t),console.log("üìç –¢–µ–∫—É—â–∏–π URL:",window.location.href),t}isTelegramWalletSupported(){return this.tg&&(typeof this.tg.openTelegramLink=="function"||typeof this.tg.openInvoice=="function"||this.tg.platform==="tdesktop"||this.tg.platform==="web")}buyWithTelegramWallet(e,t,s,i){if(!this.isTelegramWalletSupported()){confirm(`${t}

${s}

–¶–µ–Ω–∞: ${e} TON

‚ö†Ô∏è –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú

–ö—É–ø–∏—Ç—å?`)?(alert(`‚ö†Ô∏è –¢–ï–°–¢–û–í–ê–Ø –ü–û–ö–£–ü–ö–ê
–í —Ä–µ–∞–ª—å–Ω–æ–º Telegram –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –∫–æ—à–µ–ª–µ–∫`),i(!0)):i(!1);return}try{const o=this.createTonWalletLink(e,t,s);this.tg.showPopup({title:"–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Wallet",message:`${t}

${s}

–°—É–º–º–∞: ${e} TON`,buttons:[{id:"cancel",type:"cancel",text:"–û—Ç–º–µ–Ω–∞"},{id:"pay",type:"default",text:"–û–ø–ª–∞—Ç–∏—Ç—å"}]},r=>{r==="pay"?(this.tg.openTelegramLink(o),setTimeout(()=>{this.tg.showAlert("–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∏–≥—Ä—É. –ü–æ–∫—É–ø–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.")},1e3),setTimeout(()=>{i(!0)},3e3)):i(!1)})}catch(o){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Telegram Wallet:",o),this.showAlert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ—à–µ–ª—å–∫–∞"),i(!1)}}createTonWalletLink(e,t,s){const i="UQCyKauWQCbKjU3B5aeA95GhclvILmpfQvYWN3Ojjhhj2Jaz",o=Math.floor(e*1e9);return`ton://transfer/${i}?amount=${o}&text=${encodeURIComponent(`${t}: ${s}`)}`}buyWithTonConnect(e,t,s,i){if(window.TonConnect){const o={validUntil:Math.floor(Date.now()/1e3)+600,messages:[{address:"UQCyKauWQCbKjU3B5aeA95GhclvILmpfQvYWN3Ojjhhj2Jaz",amount:(e*1e9).toString(),payload:btoa(`${t}: ${s}`)}]};window.TonConnect.sendTransaction(o).then(r=>{console.log("–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞:",r),this.hapticFeedback("notification","success"),i(!0)}).catch(r=>{console.error("–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:",r),i(!1)})}else console.warn("‚ö†Ô∏è TON Connect –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback"),this.buyWithTelegramWallet(e,t,s,i)}async initTonConnect(){if(typeof window.TonConnect<"u")try{return this.tonConnect=new window.TonConnect({manifestUrl:"/tonconnect-manifest.json"}),console.log("‚úÖ TON Connect –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"),!0}catch(e){return console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TON Connect:",e),!1}else return console.warn("‚ö†Ô∏è TON Connect SDK –Ω–µ –Ω–∞–π–¥–µ–Ω"),!1}buyWithStars(e,t,s,i){if(this.tg){const o=`${t}

${s}

–¶–µ–Ω–∞: ${e} ‚≠ê`;this.tg.showPopup({title:"–ü–æ–∫—É–ø–∫–∞ –∑–∞ –∑–≤–µ–∑–¥—ã",message:o,buttons:[{id:"cancel",type:"cancel",text:"–û—Ç–º–µ–Ω–∞"},{id:"buy",type:"default",text:`–ö—É–ø–∏—Ç—å –∑–∞ ${e} ‚≠ê`}]},r=>{r==="buy"?(this.hapticFeedback("notification","success"),this.showAlert(`‚ö†Ô∏è –¢–ï–°–¢–û–í–ê–Ø –ü–û–ö–£–ü–ö–ê

–í —Ä–µ–∞–ª—å–Ω–æ–º Telegram –±–æ—Ç–µ –∑–≤–µ–∑–¥—ã –±—É–¥—É—Ç —Å–ø–∏—Å–∞–Ω—ã —á–µ—Ä–µ–∑ Bot API`),i(!0)):i(!1)})}else confirm(`${t}

${s}

–¶–µ–Ω–∞: ${e} –∑–≤–µ–∑–¥

‚ö†Ô∏è –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú

–ö—É–ø–∏—Ç—å?`)?(alert(`‚ö†Ô∏è –¢–ï–°–¢–û–í–ê–Ø –ü–û–ö–£–ü–ö–ê

–í —Ä–µ–∞–ª—å–Ω–æ–º Telegram –±–æ—Ç–µ –∑–≤–µ–∑–¥—ã –±—É–¥—É—Ç —Å–ø–∏—Å–∞–Ω—ã —á–µ—Ä–µ–∑ Bot API`),i(!0)):i(!1)}close(){this.tg&&this.tg.close()}}class It{constructor(e){this.tg=e,this.referrals=[],this.referralEarnings=0,this.referralPercentage=.02,this.init()}init(){this.loadReferralData(),this.checkReferralCode()}checkReferralCode(){const e=this.tg.getStartParam(),t=this.tg.getUserId();console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞:",e,"–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:",t),e&&t&&e!==t.toString()&&(console.log("–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª–∞:",e,"->",t),this.registerReferral(e,t))}registerReferral(e,t){if(this.getReferralData(t))return console.log("User already has a referrer"),!1;const i={referrerId:e,referredUserId:t,timestamp:Date.now(),totalEarnings:0};return localStorage.setItem(`referral_${t}`,JSON.stringify(i)),this.showReferralWelcome(e),!0}getReferralData(e){try{const t=localStorage.getItem(`referral_${e}`);return t?JSON.parse(t):null}catch(t){return console.error("Error loading referral data:",t),null}}addReferralEarning(e,t){const s=this.getReferralData(e);if(!s)return 0;const i=Math.floor(t*this.referralPercentage);return s.totalEarnings+=t,localStorage.setItem(`referral_${e}`,JSON.stringify(s)),this.addReferrerBonus(s.referrerId,i),i}addReferrerBonus(e,t){const s=this.tg.getUserId();e===(s==null?void 0:s.toString())&&(this.referralEarnings+=t,this.saveReferralData(),t>0&&this.showReferralBonus(t))}getUserReferrals(){const e=this.tg.getUserId();if(!e)return[];const t=[];for(let s=0;s<localStorage.length;s++){const i=localStorage.key(s);if(i&&i.startsWith("referral_"))try{const o=JSON.parse(localStorage.getItem(i));o.referrerId===e.toString()&&t.push({userId:o.referredUserId,timestamp:o.timestamp,totalEarnings:o.totalEarnings,bonus:Math.floor(o.totalEarnings*this.referralPercentage)})}catch(o){console.error("Error parsing referral data:",o)}}return t.sort((s,i)=>i.timestamp-s.timestamp)}getReferralLink(){const e=this.tg.getUserId();return e?this.tg.createReferralLink(e):null}copyReferralLink(){const e=this.getReferralLink();return e?(navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{this.showNotification("–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!","success")}).catch(()=>{this.fallbackCopyTextToClipboard(e)}):this.fallbackCopyTextToClipboard(e),!0):!1}fallbackCopyTextToClipboard(e){const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.showNotification("–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!","success")}catch(s){console.error("Fallback: Oops, unable to copy",s),this.showNotification("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É","error")}document.body.removeChild(t)}showReferralWelcome(e){this.showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${e}`,"success")}showReferralBonus(e){this.showNotification(`–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å: +${this.formatNumber(e)}`,"success")}getReferralStats(){const e=this.getUserReferrals(),t=e.length,s=e.reduce((o,r)=>o+r.totalEarnings,0),i=e.reduce((o,r)=>o+r.bonus,0);return{totalReferrals:t,totalEarnings:s,totalBonus:i,referralEarnings:this.referralEarnings}}saveReferralData(){const e={referralEarnings:this.referralEarnings,timestamp:Date.now()};localStorage.setItem("referralSystemData",JSON.stringify(e))}loadReferralData(){try{const e=localStorage.getItem("referralSystemData");if(e){const t=JSON.parse(e);this.referralEarnings=t.referralEarnings||0}}catch(e){console.error("Error loading referral system data:",e)}}formatNumber(e){return isNaN(e)||e===null||e===void 0?"0":(e=Math.floor(e),e<0?"-"+this.formatNumber(Math.abs(e)):e>=1e12?(e/1e12).toFixed(2)+"T":e>=1e9?(e/1e9).toFixed(2)+"B":e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString())}showNotification(e,t="info"){const s=document.createElement("div");s.className=`notification ${t}`,s.textContent=e;const i={success:"#4CAF50",error:"#f44336",warning:"#ff9800",info:"#2196F3"};s.style.cssText=`
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: ${i[t]};
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            font-weight: bold;
            animation: slideDown 0.3s ease-out;
        `,document.body.appendChild(s),setTimeout(()=>{s.style.animation="slideUp 0.3s ease-out",setTimeout(()=>s.remove(),300)},3e3)}saveState(){return{referrals:this.referrals,totalEarnings:this.totalEarnings,referralCode:this.referralCode}}loadState(e){e&&(this.referrals=e.referrals||[],this.totalEarnings=e.totalEarnings||0,this.referralCode=e.referralCode||this.referralCode)}}class jt{constructor(){console.log("BoostSystem constructor called"),this.activeBoosts=new Map,this.boostHistory=[],this.permanentMultiplier=1,this.init()}init(){console.log("BoostSystem init called"),this.loadBoostData(),this.startBoostTimer()}applyBoost(e,t,s,i="unknown"){console.log("applyBoost called with type:",e,"multiplier:",t,"duration:",s,"source:",i);const o=this.generateBoostId(),r={id:o,type:e,multiplier:t,duration:s,source:i,startTime:Date.now(),endTime:Date.now()+s};return console.log("Created boost:",r),this.activeBoosts.set(o,r),this.boostHistory.push({...r,applied:!0}),console.log("Boost added to activeBoosts and boostHistory"),this.showBoostNotification(r),this.updateBoostDisplay(),console.log("Boost notification shown and display updated"),console.log("Setting timeout to remove boost in",s,"ms"),setTimeout(()=>{console.log("Timeout expired, removing boost:",o),this.removeBoost(o)},s),o}removeBoost(e){console.log("removeBoost called with boostId:",e);const t=this.activeBoosts.get(e);t?(console.log("Boost found, removing it:",t),this.activeBoosts.delete(e),this.showBoostEndNotification(t),this.updateBoostDisplay(),console.log("Boost removed and display updated")):console.log("Boost not found for boostId:",e)}getActiveBoosts(){console.log("getActiveBoosts called, current active boosts:",this.activeBoosts.size);const e=Date.now();let t=0;for(const[i,o]of this.activeBoosts)e>=o.endTime&&(console.log("Removing expired boost:",i),this.activeBoosts.delete(i),t++);console.log("Removed",t,"expired boosts");const s=Array.from(this.activeBoosts.values());return console.log("getActiveBoosts result:",s.length,"boosts"),s}getClickMultiplier(){let e=this.permanentMultiplier;const t=this.getActiveBoosts();return console.log("getClickMultiplier base multiplier:",e,"active boosts:",t.length),t.forEach(s=>{(s.type==="click"||s.type==="all")&&(e*=s.multiplier,console.log("Applied boost:",s.type,s.multiplier,"new multiplier:",e))}),console.log("getClickMultiplier result:",e),e}getAutoMultiplier(){console.log("getAutoMultiplier called, permanentMultiplier:",this.permanentMultiplier);let e=this.permanentMultiplier;const t=this.getActiveBoosts();return console.log("Active boosts for auto multiplier:",t.length),t.forEach(s=>{(s.type==="auto"||s.type==="all")&&(console.log("Applying auto boost:",s.type,s.multiplier,"to multiplier:",e),e*=s.multiplier)}),console.log("getAutoMultiplier result:",e),e}hasActiveAdBoost(){console.log("hasActiveAdBoost called, activeBoosts size:",this.activeBoosts.size);const e=Date.now();for(const[t,s]of this.activeBoosts)if(s.source==="advertisement"&&s.endTime>e)return console.log("Active ad boost found:",s),!0;return console.log("No active ad boost found"),!1}canWatchAd(){console.log("canWatchAd called");const e=localStorage.getItem("lastAdWatch");console.log("Last ad watch time:",e);const t=Date.now(),s=9e4;if(console.log("Current time:",t,"cooldown:",s),e&&t-parseInt(e)<s){const i=Math.ceil((s-(t-parseInt(e)))/1e3);return console.log("Ad cooldown active, time left:",i),{canWatch:!1,timeLeft:i}}return console.log("Ad can be watched"),{canWatch:!0}}applyAdBoost(){if(console.log("applyAdBoost called"),this.hasActiveAdBoost())return console.log("Ad boost already active"),{success:!1,message:"–£ –≤–∞—Å —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω –±—É—Å—Ç –æ—Ç —Ä–µ–∫–ª–∞–º—ã!"};const e=this.canWatchAd();if(console.log("Ad check result:",e),!e.canWatch)return{success:!1,message:`–°–ª–µ–¥—É—é—â–∞—è —Ä–µ–∫–ª–∞–º–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ ${e.timeLeft} —Å–µ–∫`};localStorage.setItem("lastAdWatch",Date.now().toString()),console.log("Last ad watch time saved");const t=this.applyBoost("all",2,6e4,"advertisement");return console.log("Ad boost applied with boostId:",t),{success:!0,message:"–ë—É—Å—Ç x2 –æ—Ç —Ä–µ–∫–ª–∞–º—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 1 –º–∏–Ω—É—Ç—É!",boostId:t}}generateBoostId(){const e="boost_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return console.log("generateBoostId result:",e),e}showBoostNotification(e){console.log("showBoostNotification called with boost:",e);const t=`–ë—É—Å—Ç x${e.multiplier} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ ${Math.ceil(e.duration/1e3)} —Å–µ–∫!`;console.log("Showing boost notification:",t),this.showNotification(t,"success")}showBoostEndNotification(e){console.log("showBoostEndNotification called with boost:",e),this.showNotification("–ë—É—Å—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è","info")}updateBoostDisplay(){console.log("updateBoostDisplay called"),this.updateBoostTimer()}updateBoostTimer(){console.log("updateBoostTimer called");const e=this.getActiveBoosts();console.log("Active boosts for timer:",e.length);const t=document.getElementById("boost-timer");if(console.log("Existing timer element:",t?"found":"not found"),e.length===0){t&&(console.log("No active boosts, removing timer"),t.remove());return}const s=e.reduce((r,a)=>a.multiplier>r.multiplier?a:r);console.log("Strongest boost:",s);const i=Math.ceil((s.endTime-Date.now())/1e3);if(console.log("Time left for boost:",i),i<=0){t&&(console.log("Time expired, removing timer"),t.remove());return}let o=t;o||(console.log("Creating new timer element"),o=document.createElement("div"),o.id="boost-timer",o.className="boost-timer-display",o.style.cssText=`
                position: fixed;
                top: 70px;
                right: 20px;
                background: linear-gradient(135deg, #4CAF50, #45a049);
                color: white;
                padding: 10px 20px;
                border-radius: 25px;
                font-weight: bold;
                box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
                z-index: 1000;
                animation: pulse 1s infinite;
                font-size: 14px;
            `,document.body.appendChild(o)),o.textContent=`–ë—É—Å—Ç x${s.multiplier}: ${i}—Å`,console.log("Timer updated with text:",o.textContent)}startBoostTimer(){console.log("startBoostTimer called"),setInterval(()=>{console.log("Boost timer interval triggered"),this.updateBoostDisplay()},1e3)}getBoostStats(){console.log("getBoostStats called");const e=this.getActiveBoosts(),t=this.boostHistory.length,s=this.getClickMultiplier(),i=this.getAutoMultiplier();console.log("Boost stats - active:",e.length,"total:",t,"clickMultiplier:",s,"autoMultiplier:",i);const o={activeBoosts:e.length,totalBoosts:t,clickMultiplier:s,autoMultiplier:i};return console.log("getBoostStats result:",o),o}saveBoostData(){const e={boostHistory:this.boostHistory.slice(-100),timestamp:Date.now()};localStorage.setItem("boostSystemData",JSON.stringify(e))}loadBoostData(){try{const e=localStorage.getItem("boostSystemData");if(e){const t=JSON.parse(e);this.boostHistory=t.boostHistory||[]}}catch(e){console.error("Error loading boost system data:",e)}}showNotification(e,t="info"){console.log("showNotification called with message:",e,"type:",t);const s=document.createElement("div");s.className=`notification ${t}`,s.textContent=e;const i={success:"#4CAF50",error:"#f44336",warning:"#ff9800",info:"#2196F3"};s.style.cssText=`
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: ${i[t]};
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            font-weight: bold;
            animation: slideDown 0.3s ease-out;
        `,document.body.appendChild(s),console.log("Notification added to DOM"),setTimeout(()=>{s.style.animation="slideUp 0.3s ease-out",setTimeout(()=>{s.remove(),console.log("Notification removed from DOM")},300)},3e3)}hasPermanentBoost(){console.log("hasPermanentBoost called, permanentMultiplier:",this.permanentMultiplier);const e=this.permanentMultiplier>1;return console.log("hasPermanentBoost result:",e),e}activatePermanentBoost(){return console.log("activatePermanentBoost called, current permanentMultiplier:",this.permanentMultiplier),this.hasPermanentBoost()?(console.log("Permanent boost already purchased"),{success:!1,message:"–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±—É—Å—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω!"}):(this.permanentMultiplier=2,this.saveBoostData(),console.log("Permanent boost activated, new multiplier:",this.permanentMultiplier),{success:!0,message:"–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±—É—Å—Ç x2 –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞–≤—Å–µ–≥–¥–∞!"})}saveBoostData(){console.log("saveBoostData called, permanentMultiplier:",this.permanentMultiplier,"boostHistory length:",this.boostHistory.length);const e={permanentMultiplier:this.permanentMultiplier,boostHistory:this.boostHistory.slice(-50)};console.log("Saving boost data:",e),localStorage.setItem("boostSystemData",JSON.stringify(e))}loadBoostData(){console.log("loadBoostData called");try{const e=localStorage.getItem("boostSystemData");if(console.log("Saved boost data:",e),e){const t=JSON.parse(e);this.permanentMultiplier=t.permanentMultiplier||1,this.boostHistory=t.boostHistory||[],console.log("Boost data loaded, permanentMultiplier:",this.permanentMultiplier,"boostHistory length:",this.boostHistory.length)}}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±—É—Å—Ç–æ–≤:",e)}}saveState(){console.log("saveState called, activeBoosts size:",this.activeBoosts.size,"boostHistory length:",this.boostHistory.length,"permanentMultiplier:",this.permanentMultiplier);const e={activeBoosts:Array.from(this.activeBoosts.entries()),boostHistory:this.boostHistory.slice(-50),permanentMultiplier:this.permanentMultiplier};return console.log("saveState result:",e),e}loadState(e){console.log("loadState called with data:",e),e&&e.activeBoosts&&(this.activeBoosts=new Map(e.activeBoosts),console.log("Active boosts loaded, new size:",this.activeBoosts.size)),e&&e.boostHistory&&(this.boostHistory=e.boostHistory,console.log("Boost history loaded, new length:",this.boostHistory.length)),e&&e.permanentMultiplier&&(this.permanentMultiplier=e.permanentMultiplier,console.log("Permanent multiplier loaded, new value:",this.permanentMultiplier))}}class Dt{constructor(){this.sounds={},this.soundEnabled=!0,this.musicEnabled=!0,this.volume=.3,this.init()}init(){this.loadSettings(),this.initSounds()}initSounds(){const e={click:{frequency:800,duration:.1,type:"sine",volume:.2},purchase:{frequency:600,duration:.3,type:"square",volume:.3},upgrade:{frequency:1e3,duration:.4,type:"sawtooth",volume:.25},boost:{frequency:1200,duration:.5,type:"triangle",volume:.3},unlock:{frequency:1500,duration:.6,type:"sine",volume:.35},error:{frequency:300,duration:.2,type:"square",volume:.2},notification:{frequency:900,duration:.3,type:"sine",volume:.25}};this.audioContext=null;try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),Object.keys(e).forEach(t=>{this.sounds[t]=e[t]}),console.log("Sound system initialized successfully")}catch{console.warn("Web Audio API not supported, using fallback sounds"),this.initFallbackSounds()}}initFallbackSounds(){const e={click:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+0Oy9diMFl2+z5yUCnQAAS5oAAABjAA",purchase:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+0Oy9diMFl2+z5yUCnQAAS5oAAABjAA",upgrade:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+0Oy9diMFl2+z5yUCnQAAS5oAAABjAA",boost:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+0Oy9diMFl2+z5yUCnQAAS5oAAABjAA"};try{for(const[t,s]of Object.entries(e)){const i=new Audio(s);i.volume=this.volume,this.sounds[t]={audio:i}}}catch(t){console.log("Audio initialization failed:",t)}}playSound(e){if(!(!this.soundEnabled||!this.sounds[e]))try{this.audioContext?this.playWebAudioSound(e):this.sounds[e].audio&&this.playFallbackSound(e)}catch(t){console.log("Sound play error:",t)}}playWebAudioSound(e){const t=this.sounds[e];if(!t)return;const s=this.audioContext.createOscillator(),i=this.audioContext.createGain();s.connect(i),i.connect(this.audioContext.destination),s.frequency.setValueAtTime(t.frequency,this.audioContext.currentTime),s.type=t.type,i.gain.setValueAtTime(0,this.audioContext.currentTime),i.gain.linearRampToValueAtTime(t.volume*this.volume,this.audioContext.currentTime+.01),i.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+t.duration),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+t.duration)}playFallbackSound(e){const t=this.sounds[e].audio;t&&(t.currentTime=0,t.volume=this.volume,t.play().catch(()=>{}))}setSoundEnabled(e){this.soundEnabled=e,this.saveSettings()}setMusicEnabled(e){this.musicEnabled=e,this.saveSettings()}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.saveSettings()}getSettings(){return{soundEnabled:this.soundEnabled,musicEnabled:this.musicEnabled,volume:this.volume}}saveSettings(){const e={soundEnabled:this.soundEnabled,musicEnabled:this.musicEnabled,volume:this.volume};localStorage.setItem("soundSettings",JSON.stringify(e))}loadSettings(){try{const e=localStorage.getItem("soundSettings");if(e){const t=JSON.parse(e);this.soundEnabled=t.soundEnabled!==void 0?t.soundEnabled:!0,this.musicEnabled=t.musicEnabled!==void 0?t.musicEnabled:!0,this.volume=t.volume!==void 0?t.volume:.3}}catch(e){console.error("Error loading sound settings:",e)}}playClickSound(){this.playSound("click")}playPurchaseSound(){this.playSound("purchase")}playUpgradeSound(){this.playSound("upgrade")}playBoostSound(){this.playSound("boost")}playUnlockSound(){this.playSound("unlock")}playErrorSound(){this.playSound("error")}playNotificationSound(){this.playSound("notification")}createClickEffect(e=800){if(!(!this.soundEnabled||!this.audioContext))try{const t=this.audioContext.createOscillator(),s=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.connect(i),i.connect(s),s.connect(this.audioContext.destination),t.frequency.setValueAtTime(e,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(e*.5,this.audioContext.currentTime+.1),t.type="sine",i.type="lowpass",i.frequency.setValueAtTime(2e3,this.audioContext.currentTime),s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(this.volume*.3,this.audioContext.currentTime+.01),s.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.15),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.15)}catch(t){console.log("Click effect error:",t)}}createMoneyEffect(){if(!(!this.soundEnabled||!this.audioContext))try{[523.25,659.25,783.99].forEach((t,s)=>{setTimeout(()=>{const i=this.audioContext.createOscillator(),o=this.audioContext.createGain();i.connect(o),o.connect(this.audioContext.destination),i.frequency.setValueAtTime(t,this.audioContext.currentTime),i.type="sine",o.gain.setValueAtTime(0,this.audioContext.currentTime),o.gain.linearRampToValueAtTime(this.volume*.2,this.audioContext.currentTime+.01),o.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.3),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.3)},s*50)})}catch(e){console.log("Money effect error:",e)}}destroy(){this.audioContext&&this.audioContext.close(),this.sounds={}}}class Rt{constructor(){console.log("PrestigeSystem constructor called"),this.prestigeLevel=0,this.prestigeBonus=0,this.currentSystem="solar",this.unlockedSystems=["solar"],this.prestigeCost=1e6,this.starSystems=this.initializeStarSystems(),this.loadPrestigeData()}initializeStarSystems(){console.log("initializeStarSystems called");const e={solar:{name:"–°–æ–ª–Ω–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",description:"–ù–∞—à —Ä–æ–¥–Ω–æ–π –¥–æ–º",planets:{earth:{name:"–ó–µ–º–ª—è",description:"–ù–∞—à —Ä–æ–¥–Ω–æ–π –¥–æ–º",price:0,boost:1,unlocked:!0},mars:{name:"–ú–∞—Ä—Å",description:"–ö—Ä–∞—Å–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞",price:1e3,boost:1.5,unlocked:!1},venus:{name:"–í–µ–Ω–µ—Ä–∞",description:"–ü–ª–∞–Ω–µ—Ç–∞ –ª—é–±–≤–∏ –∏ –∫—Ä–∞—Å–æ—Ç—ã",price:2500,boost:2,unlocked:!1},jupiter:{name:"–Æ–ø–∏—Ç–µ—Ä",description:"–ì–∞–∑–æ–≤—ã–π –≥–∏–≥–∞–Ω—Ç",price:5e3,boost:2.5,unlocked:!1},saturn:{name:"–°–∞—Ç—É—Ä–Ω",description:"–ü–ª–∞–Ω–µ—Ç–∞ —Å –∫–æ–ª—å—Ü–∞–º–∏",price:1e4,boost:3,unlocked:!1},neptune:{name:"–ù–µ–ø—Ç—É–Ω",description:"–õ–µ–¥—è–Ω–æ–π –≥–∏–≥–∞–Ω—Ç",price:25e3,boost:3.5,unlocked:!1},sun:{name:"–°–æ–ª–Ω—Ü–µ",description:"–ò—Å—Ç–æ—á–Ω–∏–∫ –≤—Å–µ–π —ç–Ω–µ—Ä–≥–∏–∏",price:5e4,boost:4,unlocked:!1}}},alpha:{name:"–ê–ª—å—Ñ–∞ –¶–µ–Ω—Ç–∞–≤—Ä–∞",description:"–ë–ª–∏–∂–∞–π—à–∞—è –∑–≤—ë–∑–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",planets:{proxima:{name:"–ü—Ä–æ–∫—Å–∏–º–∞ b",description:"–≠–∫–∑–æ–ø–ª–∞–Ω–µ—Ç–∞ –≤ –∑–æ–Ω–µ –∂–∏–∑–Ω–∏",price:0,boost:5,unlocked:!0},kepler:{name:"–ö–µ–ø–ª–µ—Ä-442b",description:"–°—É–ø–µ—Ä–∑–µ–º–ª—è –≤ –∑–æ–Ω–µ –∂–∏–∑–Ω–∏",price:1e5,boost:6,unlocked:!1},gliese:{name:"–ì–ª–∏–∑–µ-667Cc",description:"–ö–∞–º–µ–Ω–∏—Å—Ç–∞—è —ç–∫–∑–æ–ø–ª–∞–Ω–µ—Ç–∞",price:2e5,boost:7,unlocked:!1},trappist:{name:"TRAPPIST-1e",description:"–ü–ª–∞–Ω–µ—Ç–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ –∫–∞—Ä–ª–∏–∫–∞",price:4e5,boost:8,unlocked:!1},hd:{name:"HD 40307g",description:"–°—É–ø–µ—Ä–∑–µ–º–ª—è –≤ —Ç—Ä–æ–π–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ",price:8e5,boost:9,unlocked:!1},wolf:{name:"Wolf 1061c",description:"–ö–∞–º–µ–Ω–∏—Å—Ç–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ –∫–∞—Ä–ª–∏–∫–∞",price:15e5,boost:10,unlocked:!1},alpha_star:{name:"–ê–ª—å—Ñ–∞ –¶–µ–Ω—Ç–∞–≤—Ä–∞ A",description:"–ñ—ë–ª—Ç—ã–π –∫–∞—Ä–ª–∏–∫",price:3e6,boost:12,unlocked:!1}}},vega:{name:"–°–∏—Å—Ç–µ–º–∞ –í–µ–≥–∏",description:"–Ø—Ä–∫–∞—è –∑–≤–µ–∑–¥–∞ —Å–æ–∑–≤–µ–∑–¥–∏—è –õ–∏—Ä—ã",planets:{vega_1:{name:"–í–µ–≥–∞ I",description:"–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞",price:0,boost:15,unlocked:!0},vega_2:{name:"–í–µ–≥–∞ II",description:"–ì–∞–∑–æ–≤—ã–π –≥–∏–≥–∞–Ω—Ç —Å –∫–æ–ª—å—Ü–∞–º–∏",price:5e6,boost:18,unlocked:!1},arcturus:{name:"–ê—Ä–∫—Ç—É—Ä b",description:"–ü–ª–∞–Ω–µ—Ç–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ –≥–∏–≥–∞–Ω—Ç–∞",price:1e7,boost:22,unlocked:!1},sirius:{name:"–°–∏—Ä–∏—É—Å b",description:"–ü–ª–∞–Ω–µ—Ç–∞ –¥–≤–æ–π–Ω–æ–π –∑–≤–µ–∑–¥—ã",price:2e7,boost:26,unlocked:!1},betelgeuse:{name:"–ë–µ—Ç–µ–ª—å–≥–µ–π–∑–µ b",description:"–ü–ª–∞–Ω–µ—Ç–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ —Å–≤–µ—Ä—Ö–≥–∏–≥–∞–Ω—Ç–∞",price:4e7,boost:30,unlocked:!1},rigel:{name:"–†–∏–≥–µ–ª—å b",description:"–ü–ª–∞–Ω–µ—Ç–∞ –≥–æ–ª—É–±–æ–≥–æ —Å–≤–µ—Ä—Ö–≥–∏–≥–∞–Ω—Ç–∞",price:8e7,boost:35,unlocked:!1},vega_star:{name:"–í–µ–≥–∞",description:"–Ø—Ä–∫–∞—è –≥–æ–ª—É–±–∞—è –∑–≤–µ–∑–¥–∞",price:2e8,boost:50,unlocked:!1}}}};return console.log("Initialized star systems:",e),e}getLastPlanet(e){const t=this.starSystems[e];if(!t)return null;const s=Object.values(t.planets);return s.sort((i,o)=>o.price-i.price),console.log("getLastPlanet for system:",e,s.map(i=>({name:i.name,price:i.price,unlocked:i.unlocked}))),s[0]}canPrestige(e){console.log("canPrestige called with money:",e);const t=this.getLastPlanet(this.currentSystem),s=t?t.unlocked:!1,i=t?t.price*2:this.prestigeCost;console.log("Prestige check:",{currentSystem:this.currentSystem,lastPlanet:t?t.name:"none",lastPlanetUnlocked:s,money:e,prestigeCost:i,canPrestige:s&&e>=i});const o=s&&e>=i;return console.log("canPrestige result:",o),o}performPrestige(e){console.log("performPrestige called with money:",e);const t=this.getLastPlanet(this.currentSystem),s=t?t.price*2:this.prestigeCost;if(console.log("Performing prestige check:",{currentSystem:this.currentSystem,lastPlanet:t?t.name:"none",lastPlanetUnlocked:t?t.unlocked:!1,money:e,prestigeCost:s}),!this.canPrestige(e)){const o=this.getLastPlanet(this.currentSystem),r=o?o.unlocked:!1,a=o?o.price*2:this.prestigeCost;return console.log("Prestige failed:",{reason:r?"not enough money":"last planet not unlocked",lastPlanetUnlocked:r,money:e,prestigeCost:a}),r?e<a?{success:!1,message:`–ù—É–∂–Ω–æ –∏–º–µ—Ç—å ${this.formatNumber(a)} –¥–ª—è –ø—Ä–µ—Å—Ç–∏–∂–∞!`}:{success:!1,message:"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É—Å–ª–æ–≤–∏–π –¥–ª—è –ø—Ä–µ—Å—Ç–∏–∂–∞!"}:{success:!1,message:`–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–ª–∞–Ω–µ—Ç—É –≤ —Å–∏—Å—Ç–µ–º–µ –∏ –∏–º–µ—Ç—å ${this.formatNumber(a)} –¥–ª—è –ø—Ä–µ—Å—Ç–∏–∂–∞!`}}if(e<s)return console.log("Prestige failed: not enough money for actual prestige",{money:e,prestigeCost:s,required:s}),{success:!1,message:`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –ø—Ä–µ—Å—Ç–∏–∂–∞! –ù—É–∂–Ω–æ ${this.formatNumber(s)}`};this.prestigeLevel++,console.log("Prestige level increased to:",this.prestigeLevel),this.prestigeBonus+=.5,console.log("Prestige bonus increased to:",this.prestigeBonus),this.resetCurrentSystem(),this.unlockNextSystem(),this.savePrestigeData();const i={success:!0,message:`–ü—Ä–µ—Å—Ç–∏–∂ ${this.prestigeLevel}! –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–æ–Ω—É—Å: +${this.prestigeBonus}x`,prestigeLevel:this.prestigeLevel,prestigeBonus:this.prestigeBonus};return console.log("performPrestige result:",i),i}resetCurrentSystem(){console.log("resetCurrentSystem called for system:",this.currentSystem);const e=this.starSystems[this.currentSystem];if(!e){console.log("System not found, returning");return}for(const[t,s]of Object.entries(e.planets))t===this.getStartPlanet(this.currentSystem)?(s.unlocked=!0,console.log("Planet",t,"remains unlocked")):(s.unlocked=!1,console.log("Planet",t,"locked"))}unlockNextSystem(){console.log("unlockNextSystem called, current system:",this.currentSystem,"unlocked systems:",this.unlockedSystems);const e=["solar","alpha","vega"],t=e.indexOf(this.currentSystem);if(console.log("Current index in system order:",t),t<e.length-1){const s=e[t+1];console.log("Next system in order:",s),this.unlockedSystems.includes(s)?console.log("Next system already unlocked"):(this.unlockedSystems.push(s),console.log("Unlocked next system:",s))}else console.log("Already at last system, no next system to unlock")}getStartPlanet(e){const s={solar:"earth",alpha:"proxima",vega:"vega_1"}[e]||"earth";return console.log("getStartPlanet for system:",e,s),s}switchSystem(e){if(console.log("switchSystem called with:",e),!this.unlockedSystems.includes(e))return console.log("System not unlocked, returning error"),{success:!1,message:"–°–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!"};this.currentSystem=e,console.log("Switched to system:",e),this.savePrestigeData();const t={success:!0,message:`–ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ ${this.starSystems[e].name}`,system:e};return console.log("switchSystem result:",t),t}getCurrentPlanets(){var t;console.log("getCurrentPlanets called for system:",this.currentSystem);const e=((t=this.starSystems[this.currentSystem])==null?void 0:t.planets)||{};return console.log("getCurrentPlanets for system:",this.currentSystem,e),e}getSystemInfo(e=null){console.log("getSystemInfo called with systemId:",e);const t=e||this.currentSystem,s=this.starSystems[t];return console.log("getSystemInfo for system:",t,s),s}getPrestigeBonus(){return console.log("getPrestigeBonus result:",this.prestigeBonus),this.prestigeBonus}getPrestigeLevel(){return console.log("getPrestigeLevel result:",this.prestigeLevel),this.prestigeLevel}getPrestigeCost(){const e=this.getLastPlanet(this.currentSystem),t=e?e.price*2:this.prestigeCost;return console.log("getPrestigeCost result:",t,e),t}calculatePrestigePoints(e){if(console.log("calculatePrestigePoints called with money:",e),!this.canPrestige(e))return console.log("Cannot prestige, returning 0 points"),0;let t=Math.floor(e/1e6);console.log("Base points calculated:",t);const i={solar:1,alpha:2,vega:3}[this.currentSystem]||1;return console.log("System multiplier:",i),t*=i,t=Math.max(1,t),console.log("Final points after min check:",t),console.log("calculatePrestigePoints result:",t),t}getUnlockedSystems(){return console.log("getUnlockedSystems result:",this.unlockedSystems),[...this.unlockedSystems]}savePrestigeData(){console.log("savePrestigeData called");const e={prestigeLevel:this.prestigeLevel,prestigeBonus:this.prestigeBonus,currentSystem:this.currentSystem,unlockedSystems:this.unlockedSystems,starSystems:this.starSystems};localStorage.setItem("prestigeSystemData",JSON.stringify(e))}loadPrestigeData(){console.log("loadPrestigeData called");try{const e=localStorage.getItem("prestigeSystemData");if(e){const t=JSON.parse(e);if(console.log("Loaded prestige data:",t),this.prestigeLevel=t.prestigeLevel||0,this.prestigeBonus=t.prestigeBonus||0,this.currentSystem=t.currentSystem||"solar",this.unlockedSystems=t.unlockedSystems||["solar"],t.starSystems){for(const[s,i]of Object.entries(t.starSystems))if(this.starSystems[s])for(const[o,r]of Object.entries(i.planets))this.starSystems[s].planets[o]&&(this.starSystems[s].planets[o].unlocked=r.unlocked)}}}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ—Å—Ç–∏–∂–∞:",e)}}saveState(){console.log("saveState called");const e={prestigeLevel:this.prestigeLevel,prestigeBonus:this.prestigeBonus,currentSystem:this.currentSystem,unlockedSystems:this.unlockedSystems,starSystems:this.starSystems};return console.log("saveState result:",e),e}loadState(e){console.log("loadState called with:",e),e&&(this.prestigeLevel=e.prestigeLevel||0,this.prestigeBonus=e.prestigeBonus||0,this.currentSystem=e.currentSystem||"solar",this.unlockedSystems=e.unlockedSystems||["solar"],console.log("Loaded prestige data:",{prestigeLevel:this.prestigeLevel,prestigeBonus:this.prestigeBonus,currentSystem:this.currentSystem,unlockedSystems:this.unlockedSystems}),e.starSystems&&(this.starSystems=e.starSystems,console.log("Loaded star systems data")))}formatNumber(e){if(console.log("formatNumber called with:",e),isNaN(e)||e===null||e===void 0)return console.log("formatNumber returning 0 due to invalid input"),"0";if(e=Math.floor(e),console.log("formatNumber after Math.floor:",e),e<0){const s="-"+this.formatNumber(Math.abs(e));return console.log("formatNumber returning negative result:",s),s}if(e>=1e12){const s=(e/1e12).toFixed(2)+"T";return console.log("formatNumber returning T result:",s),s}if(e>=1e9){const s=(e/1e9).toFixed(2)+"B";return console.log("formatNumber returning B result:",s),s}if(e>=1e6){const s=(e/1e6).toFixed(2)+"M";return console.log("formatNumber returning M result:",s),s}if(e>=1e3){const s=(e/1e3).toFixed(1)+"K";return console.log("formatNumber returning K result:",s),s}const t=e.toString();return console.log("formatNumber returning base result:",t),t}}const Lt="modulepreload",Nt=function(n,e){return new URL(n,e).href},He={},le=function(e,t,s){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=Nt(o,s),o in He)return;He[o]=!0;const r=o.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(!!s)for(let u=i.length-1;u>=0;u--){const h=i[u];if(h.href===o&&(!r||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const c=document.createElement("link");if(c.rel=r?"stylesheet":Lt,r||(c.as="script",c.crossOrigin=""),c.href=o,document.head.appendChild(c),r)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e()).catch(o=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o})},Ft=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>le(()=>Promise.resolve().then(()=>ee),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Ve extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Vt extends Ve{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ke extends Ve{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Je extends Ve{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Oe;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Oe||(Oe={}));var zt=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};class qt{constructor(e,{headers:t={},customFetch:s,region:i=Oe.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Ft(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return zt(this,void 0,void 0,function*(){try{const{headers:i,method:o,body:r}=t;let a={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;r&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&r instanceof Blob||r instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=r):typeof r=="string"?(a["Content-Type"]="text/plain",u=r):typeof FormData<"u"&&r instanceof FormData?u=r:(a["Content-Type"]="application/json",u=JSON.stringify(r)));const h=yield this.fetch(c.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:u}).catch(b=>{throw new Vt(b)}),d=h.headers.get("x-relay-error");if(d&&d==="true")throw new Ke(h);if(!h.ok)throw new Je(h);let g=((s=h.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),p;return g==="application/json"?p=yield h.json():g==="application/octet-stream"?p=yield h.blob():g==="text/event-stream"?p=h:g==="multipart/form-data"?p=yield h.formData():p=yield h.text(),{data:p,error:null,response:h}}catch(i){return{data:null,error:i,response:i instanceof Je||i instanceof Ke?i.context:void 0}}})}}var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wt(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var i=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return n[s]}})}),t}var x={},ze={},ye={},ce={},ve={},be={},Gt=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Z=Gt();const Ht=Z.fetch,ht=Z.fetch.bind(Z),dt=Z.Headers,Kt=Z.Request,Jt=Z.Response,ee=Object.freeze(Object.defineProperty({__proto__:null,Headers:dt,Request:Kt,Response:Jt,default:ht,fetch:Ht},Symbol.toStringTag,{value:"Module"})),Qt=Wt(ee);var we={};Object.defineProperty(we,"__esModule",{value:!0});let Xt=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};we.default=Xt;var gt=B&&B.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(be,"__esModule",{value:!0});const Yt=gt(Qt),Zt=gt(we);let es=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Yt.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var r,a,l;let c=null,u=null,h=null,d=o.status,g=o.statusText;if(o.ok){if(this.method!=="HEAD"){const S=await o.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=S:u=JSON.parse(S))}const b=(r=this.headers.Prefer)===null||r===void 0?void 0:r.match(/count=(exact|planned|estimated)/),m=(a=o.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");b&&m&&m.length>1&&(h=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,d=406,g="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const b=await o.text();try{c=JSON.parse(b),Array.isArray(c)&&o.status===404&&(u=[],c=null,d=200,g="OK")}catch{o.status===404&&b===""?(d=204,g="No Content"):c={message:b}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,g="OK"),c&&this.shouldThrowOnError)throw new Zt.default(c)}return{error:c,data:u,count:h,status:d,statusText:g}});return this.shouldThrowOnError||(i=i.catch(o=>{var r,a,l;return{error:{message:`${(r=o==null?void 0:o.name)!==null&&r!==void 0?r:"FetchError"}: ${o==null?void 0:o.message}`,details:`${(a=o==null?void 0:o.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=o==null?void 0:o.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}};be.default=es;var ts=B&&B.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ve,"__esModule",{value:!0});const ss=ts(be);let is=class extends ss.default{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:o=i}={}){const r=o?`${o}.order`:"order",a=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const o=typeof i>"u"?"offset":`${i}.offset`,r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(r,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:o=!1,format:r="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,o?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${r}; for="${c}"; options=${l};`,r==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};ve.default=is;var os=B&&B.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ce,"__esModule",{value:!0});const ns=os(ve);let rs=class extends ns.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let o="";i==="plain"?o="pl":i==="phrase"?o="ph":i==="websearch"&&(o="w");const r=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${o}fts${r}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};ce.default=rs;var as=B&&B.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ye,"__esModule",{value:!0});const se=as(ce);let ls=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let o=!1;const r=(e??"*").split("").map(a=>/\s/.test(a)&&!o?"":(a==='"'&&(o=!o),a)).join("");return this.url.searchParams.set("select",r),s&&(this.headers.Prefer=`count=${s}`),new se.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",o=[];if(this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),s||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const r=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(r.length>0){const a=[...new Set(r)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new se.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:o=!0}={}){const r="POST",a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),o||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new se.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new se.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new se.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};ye.default=ls;var Se={},_e={};Object.defineProperty(_e,"__esModule",{value:!0});_e.version=void 0;_e.version="0.0.0-automated";Object.defineProperty(Se,"__esModule",{value:!0});Se.DEFAULT_HEADERS=void 0;const cs=_e;Se.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${cs.version}`};var ft=B&&B.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ze,"__esModule",{value:!0});const us=ft(ye),hs=ft(ce),ds=Se;let gs=class pt{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},ds.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new us.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new pt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:o}={}){let r;const a=new URL(`${this.url}/rpc/${e}`);let l;s||i?(r=s?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{a.searchParams.append(u,h)})):(r="POST",l=t);const c=Object.assign({},this.headers);return o&&(c.Prefer=`count=${o}`),new hs.default({method:r,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};ze.default=gs;var te=B&&B.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(x,"__esModule",{value:!0});x.PostgrestError=x.PostgrestBuilder=x.PostgrestTransformBuilder=x.PostgrestFilterBuilder=x.PostgrestQueryBuilder=x.PostgrestClient=void 0;const mt=te(ze);x.PostgrestClient=mt.default;const yt=te(ye);x.PostgrestQueryBuilder=yt.default;const vt=te(ce);x.PostgrestFilterBuilder=vt.default;const bt=te(ve);x.PostgrestTransformBuilder=bt.default;const wt=te(be);x.PostgrestBuilder=wt.default;const St=te(we);x.PostgrestError=St.default;var fs=x.default={PostgrestClient:mt.default,PostgrestQueryBuilder:yt.default,PostgrestFilterBuilder:vt.default,PostgrestTransformBuilder:bt.default,PostgrestBuilder:wt.default,PostgrestError:St.default};const{PostgrestClient:ps,PostgrestQueryBuilder:_o,PostgrestFilterBuilder:ko,PostgrestTransformBuilder:Po,PostgrestBuilder:Co,PostgrestError:Ao}=fs;class ms{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const ys="2.15.1",vs=`realtime-js/${ys}`,bs="1.0.0",$e=1e4,ws=1e3,Ss=100;var oe;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(oe||(oe={}));var C;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(C||(C={}));var U;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(U||(U={}));var Ue;(function(n){n.websocket="websocket"})(Ue||(Ue={}));var q;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(q||(q={}));class _s{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),o=t.getUint8(2);let r=this.HEADER_LENGTH+2;const a=s.decode(e.slice(r,r+i));r=r+i;const l=s.decode(e.slice(r,r+o));r=r+o;const c=JSON.parse(s.decode(e.slice(r,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class _t{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var _;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(_||(_={}));const Qe=(n,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((o,r)=>(o[r]=ks(r,n,e,i),o),{})},ks=(n,e,t,s)=>{const i=e.find(a=>a.name===n),o=i==null?void 0:i.type,r=t[n];return o&&!s.includes(o)?kt(o,r):Me(r)},kt=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Es(e,t)}switch(n){case _.bool:return Ps(e);case _.float4:case _.float8:case _.int2:case _.int4:case _.int8:case _.numeric:case _.oid:return Cs(e);case _.json:case _.jsonb:return As(e);case _.timestamp:return Ts(e);case _.abstime:case _.date:case _.daterange:case _.int4range:case _.int8range:case _.money:case _.reltime:case _.text:case _.time:case _.timestamptz:case _.timetz:case _.tsrange:case _.tstzrange:return Me(e);default:return Me(e)}},Me=n=>n,Ps=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Cs=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},As=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Es=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let o;const r=n.slice(1,t);try{o=JSON.parse("["+r+"]")}catch{o=r?r.split(","):[]}return o.map(a=>kt(e,a))}return n},Ts=n=>typeof n=="string"?n.replace(" ","T"):n,Pt=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Pe{constructor(e,t,s={},i=$e){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Xe;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Xe||(Xe={}));class ne{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:o,onLeave:r,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ne.syncState(this.state,i,o,r),this.pendingDiffs.forEach(l=>{this.state=ne.syncDiff(this.state,l,o,r)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},i=>{const{onJoin:o,onLeave:r,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ne.syncDiff(this.state,i,o,r),a())}),this.onJoin((i,o,r)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:o,newPresences:r})}),this.onLeave((i,o,r)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:o,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const o=this.cloneDeep(e),r=this.transformState(t),a={},l={};return this.map(o,(c,u)=>{r[c]||(l[c]=u)}),this.map(r,(c,u)=>{const h=o[c];if(h){const d=u.map(m=>m.presence_ref),g=h.map(m=>m.presence_ref),p=u.filter(m=>g.indexOf(m.presence_ref)<0),b=h.filter(m=>d.indexOf(m.presence_ref)<0);p.length>0&&(a[c]=p),b.length>0&&(l[c]=b)}else a[c]=u}),this.syncDiff(o,{joins:a,leaves:l},s,i)}static syncDiff(e,t,s,i){const{joins:o,leaves:r}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(o,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const h=e[a].map(g=>g.presence_ref),d=u.filter(g=>h.indexOf(g.presence_ref)<0);e[a].unshift(...d)}s(a,u,l)}),this.map(r,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=c,i(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ye;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ye||(Ye={}));var re;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(re||(re={}));var I;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(I||(I={}));class qe{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=C.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Pe(this,U.join,this.params,this.timeout),this.rejoinTimer=new _t(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=C.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=C.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this._on(U.reply,{},(i,o)=>{this._trigger(this._replyEventName(o),i)}),this.presence=new ne(this),this.broadcastEndpointURL=Pt(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==C.closed){const{config:{broadcast:o,presence:r,private:a}}=this.params,l=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&i!==void 0?i:[],c=!!this.bindings[re.PRESENCE]&&this.bindings[re.PRESENCE].length>0,u={},h={broadcast:o,presence:Object.assign(Object.assign({},r),{enabled:c}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(d=>e==null?void 0:e(I.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(I.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var g;if(this.socket.setAuth(),d===void 0){e==null||e(I.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,b=(g=p==null?void 0:p.length)!==null&&g!==void 0?g:0,m=[];for(let S=0;S<b;S++){const E=p[S],{filter:{event:f,schema:w,table:O,filter:k}}=E,P=d&&d[S];if(P&&P.event===f&&P.schema===w&&P.table===O&&P.filter===k)m.push(Object.assign(Object.assign({},E),{id:P.id}));else{this.unsubscribe(),this.state=C.errored,e==null||e(I.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e(I.SUBSCRIBED);return}}).receive("error",d=>{this.state=C.errored,e==null||e(I.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(I.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===C.joined&&e===re.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:r}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:r,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var r,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(r=this.params)===null||r===void 0?void 0:r.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("error",()=>o("error")),c.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=C.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(U.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new Pe(this,U.leave,{},e),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=C.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const i=new AbortController,o=setTimeout(()=>i.abort(),s),r=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(o),r}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Pe(this,e,t,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Ss){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,o;const r=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=U;if(s&&[a,l,c,u].indexOf(r)>=0&&s!==this._joinRef())return;let d=this._onMessage(r,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(r)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var p,b,m;return((p=g.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(b=g.filter)===null||b===void 0?void 0:b.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===r}).map(g=>g.callback(d,s)):(o=this.bindings[r])===null||o===void 0||o.filter(g=>{var p,b,m,S,E,f;if(["broadcast","presence","postgres_changes"].includes(r))if("id"in g){const w=g.id,O=(p=g.filter)===null||p===void 0?void 0:p.event;return w&&((b=t.ids)===null||b===void 0?void 0:b.includes(w))&&(O==="*"||(O==null?void 0:O.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const w=(E=(S=g==null?void 0:g.filter)===null||S===void 0?void 0:S.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return w==="*"||w===((f=t==null?void 0:t.event)===null||f===void 0?void 0:f.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===r}).map(g=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:b,table:m,commit_timestamp:S,type:E,errors:f}=p;d=Object.assign(Object.assign({},{schema:b,table:m,commit_timestamp:S,eventType:E,new:{},old:{},errors:f}),this._getPayloadRecords(p))}g.callback(d,s)})}_isClosed(){return this.state===C.closed}_isJoined(){return this.state===C.joined}_isJoining(){return this.state===C.joining}_isLeaving(){return this.state===C.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),o={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(o):this.bindings[i]=[o],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var o;return!(((o=i.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===s&&qe.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(U.close,{},e)}_onError(e){this._on(U.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=C.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Qe(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Qe(e.columns,e.old_record)),t}}const Ze=()=>{},he={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},xs=[1e3,2e3,5e3,1e4],Bs=1e4,Os=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class $s{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=$e,this.transport=null,this.heartbeatIntervalMs=he.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ze,this.ref=0,this.reconnectTimer=null,this.logger=Ze,this.conn=null,this.sendBuffer=[],this.serializer=new _s,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...r)=>le(()=>Promise.resolve().then(()=>ee),void 0,import.meta.url).then(({default:a})=>a(...r)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...r)=>o(...r)},!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ue.websocket}`,this.httpEndpoint=Pt(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ms.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:bs}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case oe.connecting:return q.Connecting;case oe.open:return q.Open;case oe.closing:return q.Closing;default:return q.Closed}}isConnected(){return this.connectionState()===q.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(o=>o.topic===s);if(i)return i;{const o=new qe(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:s,payload:i,ref:o}=e,r=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${s} (${o})`,i),this.isConnected()?r():this.sendBuffer.push(r)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ws,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},he.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:i,payload:o,ref:r}=t,a=r?`(${r})`:"",l=o.status||"";this.log("receive",`${l} ${s} ${i} ${a}`.trim(),o),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(i,o,r)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(U.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Os],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:vs};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(U.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new _t(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},he.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,i,o,r,a,l,c;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:$e,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:he.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(r=e==null?void 0:e.accessToken)!==null&&r!==void 0?r:null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(a=e==null?void 0:e.reconnectAfterMs)!==null&&a!==void 0?a:u=>xs[u-1]||Bs,this.encode=(l=e==null?void 0:e.encode)!==null&&l!==void 0?l:(u,h)=>h(JSON.stringify(u)),this.decode=(c=e==null?void 0:e.decode)!==null&&c!==void 0?c:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class We extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function A(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Us extends We{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ie extends We{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ms=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};const Ct=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>le(()=>Promise.resolve().then(()=>ee),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Is=()=>Ms(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield le(()=>Promise.resolve().then(()=>ee),void 0,import.meta.url)).Response:Response}),je=n=>{if(Array.isArray(n))return n.map(t=>je(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[i]=je(s)}),e},js=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var W=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};const Ce=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ds=(n,e,t)=>W(void 0,void 0,void 0,function*(){const s=yield Is();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{const o=n.status||500,r=(i==null?void 0:i.statusCode)||o+"";e(new Us(Ce(i),o,r))}).catch(i=>{e(new Ie(Ce(i),i))}):e(new Ie(Ce(n),n))}),Rs=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"||!s?i:(js(s)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s)):i.body=s,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function ue(n,e,t,s,i,o){return W(this,void 0,void 0,function*(){return new Promise((r,a)=>{n(t,Rs(e,s,i,o)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>r(l)).catch(l=>Ds(l,a,s))})})}function pe(n,e,t,s){return W(this,void 0,void 0,function*(){return ue(n,"GET",e,t,s)})}function j(n,e,t,s,i){return W(this,void 0,void 0,function*(){return ue(n,"POST",e,s,i,t)})}function De(n,e,t,s,i){return W(this,void 0,void 0,function*(){return ue(n,"PUT",e,s,i,t)})}function Ls(n,e,t,s){return W(this,void 0,void 0,function*(){return ue(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function At(n,e,t,s,i){return W(this,void 0,void 0,function*(){return ue(n,"DELETE",e,s,i,t)})}var T=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};const Ns={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},et={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Fs{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Ct(i)}uploadOrUpdate(e,t,s,i){return T(this,void 0,void 0,function*(){try{let o;const r=Object.assign(Object.assign({},et),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(r.upsert)});const l=r.metadata;typeof Blob<"u"&&s instanceof Blob?(o=new FormData,o.append("cacheControl",r.cacheControl),l&&o.append("metadata",this.encodeMetadata(l)),o.append("",s)):typeof FormData<"u"&&s instanceof FormData?(o=s,o.append("cacheControl",r.cacheControl),l&&o.append("metadata",this.encodeMetadata(l))):(o=s,a["cache-control"]=`max-age=${r.cacheControl}`,a["content-type"]=r.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield(e=="PUT"?De:j)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:a},r!=null&&r.duplex?{duplex:r.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(o){if(A(o))return{data:null,error:o};throw o}})}upload(e,t,s){return T(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return T(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),r=this._getFinalPath(o),a=new URL(this.url+`/object/upload/sign/${r}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:et.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",c.cacheControl)):(l=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield De(this.fetch,a.toString(),l,{headers:u});return{data:{path:o,fullPath:h.Key},error:null}}catch(l){if(A(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return T(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const o=yield j(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),r=new URL(this.url+o.url),a=r.searchParams.get("token");if(!a)throw new We("No token returned by API");return{data:{signedUrl:r.toString(),path:e,token:a},error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}update(e,t,s){return T(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return T(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(A(i))return{data:null,error:i};throw i}})}copy(e,t,s){return T(this,void 0,void 0,function*(){try{return{data:{path:(yield j(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(A(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return T(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),o=yield j(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const r=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${r}`)},{data:o,error:null}}catch(i){if(A(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return T(this,void 0,void 0,function*(){try{const i=yield j(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(r=>Object.assign(Object.assign({},r),{signedUrl:r.signedURL?encodeURI(`${this.url}${r.signedURL}${o}`):null})),error:null}}catch(i){if(A(i))return{data:null,error:i};throw i}})}download(e,t){return T(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),r=o?`?${o}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield pe(this.fetch,`${this.url}/${i}/${a}${r}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(A(a))return{data:null,error:a};throw a}})}info(e){return T(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield pe(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:je(s),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}exists(e){return T(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ls(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(A(s)&&s instanceof Ie){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],o=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&i.push(o);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${c}`)}}}remove(e){return T(this,void 0,void 0,function*(){try{return{data:yield At(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}list(e,t,s){return T(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Ns),t),{prefix:e||""});return{data:yield j(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(A(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Vs="2.10.5",zs={"X-Client-Info":`storage-js/${Vs}`};var G=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};class qs{constructor(e,t={},s,i){const o=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},zs),t),this.fetch=Ct(s)}listBuckets(){return G(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}})}getBucket(e){return G(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return G(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return G(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}emptyBucket(e){return G(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}deleteBucket(e){return G(this,void 0,void 0,function*(){try{return{data:yield At(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}}class Ws extends qs{constructor(e,t={},s,i){super(e,t,s,i)}from(e){return new Fs(this.url,this.headers,e,this.fetch)}}const Gs="2.55.0";let ie="";typeof Deno<"u"?ie="deno":typeof document<"u"?ie="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ie="react-native":ie="node";const Hs={"X-Client-Info":`supabase-js-${ie}/${Gs}`},Ks={headers:Hs},Js={schema:"public"},Qs={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Xs={};var Ys=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};const Zs=n=>{let e;return n?e=n:typeof fetch>"u"?e=ht:e=fetch,(...t)=>e(...t)},ei=()=>typeof Headers>"u"?dt:Headers,ti=(n,e,t)=>{const s=Zs(t),i=ei();return(o,r)=>Ys(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:n;let c=new i(r==null?void 0:r.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(o,Object.assign(Object.assign({},r),{headers:c}))})};var si=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};function ii(n){return n.endsWith("/")?n:n+"/"}function oi(n,e){var t,s;const{db:i,auth:o,realtime:r,global:a}=n,{db:l,auth:c,realtime:u,global:h}=e,d={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),o),realtime:Object.assign(Object.assign({},u),r),storage:{},global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=a==null?void 0:a.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>si(this,void 0,void 0,function*(){return""})};return n.accessToken?d.accessToken=n.accessToken:delete d.accessToken,d}const Et="2.71.1",X=30*1e3,Re=3,Ae=Re*X,ni="http://localhost:9999",ri="supabase.auth.token",ai={"X-Client-Info":`gotrue-js/${Et}`},Le="X-Supabase-Api-Version",Tt={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},li=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ci=10*60*1e3;class Ge extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function y(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class ui extends Ge{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function hi(n){return y(n)&&n.name==="AuthApiError"}class xt extends Ge{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class N extends Ge{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class R extends N{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function di(n){return y(n)&&n.name==="AuthSessionMissingError"}class de extends N{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ge extends N{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class fe extends N{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function gi(n){return y(n)&&n.name==="AuthImplicitGrantRedirectError"}class tt extends N{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ne extends N{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ee(n){return y(n)&&n.name==="AuthRetryableFetchError"}class st extends N{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Fe extends N{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),it=` 	
\r=`.split(""),fi=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<it.length;e+=1)n[it[e].charCodeAt(0)]=-2;for(let e=0;e<me.length;e+=1)n[me[e].charCodeAt(0)]=e;return n})();function ot(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(me[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(me[s]),e.queuedBits-=6}}function Bt(n,e,t){const s=fi[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function nt(n){const e=[],t=r=>{e.push(String.fromCodePoint(r))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},o=r=>{yi(r,s,t)};for(let r=0;r<n.length;r+=1)Bt(n.charCodeAt(r),i,o);return e.join("")}function pi(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function mi(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}pi(s,e)}}function yi(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if(!(n>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function vi(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)Bt(n.charCodeAt(i),t,s);return new Uint8Array(e)}function bi(n){const e=[];return mi(n,t=>e.push(t)),new Uint8Array(e)}function wi(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return n.forEach(i=>ot(i,t,s)),ot(null,t,s),e.join("")}function Si(n){return Math.round(Date.now()/1e3)+n}function _i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const $=()=>typeof window<"u"&&typeof document<"u",F={tested:!1,writable:!1},Ot=()=>{if(!$())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(F.tested)return F.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),F.tested=!0,F.writable=!0}catch{F.tested=!0,F.writable=!1}return F.writable};function ki(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,o)=>{e[o]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const $t=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>le(()=>Promise.resolve().then(()=>ee),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Pi=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Y=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},V=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},D=async(n,e)=>{await n.removeItem(e)};class ke{constructor(){this.promise=new ke.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ke.promiseConstructor=Promise;function Te(n){const e=n.split(".");if(e.length!==3)throw new Fe("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!li.test(e[s]))throw new Fe("JWT not in base64url format");return{header:JSON.parse(nt(e[0])),payload:JSON.parse(nt(e[1])),signature:vi(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ci(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Ai(n,e){return new Promise((s,i)=>{(async()=>{for(let o=0;o<1/0;o++)try{const r=await n(o);if(!e(o,null,r)){s(r);return}}catch(r){if(!e(o,r)){i(r);return}}})()})}function Ei(n){return("0"+n.toString(16)).substr(-2)}function Ti(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let o=0;o<56;o++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,Ei).join("")}async function xi(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(o=>String.fromCharCode(o)).join("")}async function Bi(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await xi(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function H(n,e,t=!1){const s=Ti();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await Y(n,`${e}-code-verifier`,i);const o=await Bi(s);return[o,s===o?"plain":"s256"]}const Oi=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $i(n){const e=n.headers.get(Le);if(!e||!e.match(Oi))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ui(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Mi(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ii=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function K(n){if(!Ii.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function xe(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function rt(n){return JSON.parse(JSON.stringify(n))}var ji=globalThis&&globalThis.__rest||function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};const z=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Di=[502,503,504];async function at(n){var e;if(!Pi(n))throw new Ne(z(n),0);if(Di.includes(n.status))throw new Ne(z(n),n.status);let t;try{t=await n.json()}catch(o){throw new xt(z(o),o)}let s;const i=$i(n);if(i&&i.getTime()>=Tt["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new st(z(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new R}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,r)=>o&&typeof r=="string",!0))throw new st(z(t),n.status,t.weak_password.reasons);throw new ui(z(t),n.status||500,s)}const Ri=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function v(n,e,t,s){var i;const o=Object.assign({},s==null?void 0:s.headers);o[Le]||(o[Le]=Tt["2024-01-01"].name),s!=null&&s.jwt&&(o.Authorization=`Bearer ${s.jwt}`);const r=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(r.redirect_to=s.redirectTo);const a=Object.keys(r).length?"?"+new URLSearchParams(r).toString():"",l=await Li(n,e,t+a,{headers:o,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function Li(n,e,t,s,i,o){const r=Ri(e,s,i,o);let a;try{a=await n(t,Object.assign({},r))}catch(l){throw console.error(l),new Ne(z(l),0)}if(a.ok||await at(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(l){await at(l)}}function M(n){var e;let t=null;zi(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Si(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function lt(n){const e=M(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function L(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Ni(n){return{data:n,error:null}}function Fi(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:o}=n,r=ji(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:o},l=Object.assign({},r);return{data:{properties:a,user:l},error:null}}function Vi(n){return n}function zi(n){return n.access_token&&n.refresh_token&&n.expires_in}const Be=["global","local","others"];var qi=globalThis&&globalThis.__rest||function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};class Wi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=$t(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Be[0]){if(Be.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Be.join(", ")}`);try{return await v(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(y(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await v(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:L})}catch(s){if(y(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=qi(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await v(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Fi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(y(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await v(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:L})}catch(t){if(y(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,o,r,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await v(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(o=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""},xform:Vi});if(u.error)throw u.error;const h=await u.json(),d=(r=u.headers.get("x-total-count"))!==null&&r!==void 0?r:0,g=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(p=>{const b=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=b}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(y(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){K(e);try{return await v(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:L})}catch(t){if(y(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){K(e);try{return await v(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:L})}catch(s){if(y(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){K(e);try{return await v(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:L})}catch(s){if(y(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){K(e.userId);try{const{data:t,error:s}=await v(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(y(t))return{data:null,error:t};throw t}}async _deleteFactor(e){K(e.userId),K(e.id);try{return{data:await v(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(y(t))return{data:null,error:t};throw t}}}function ct(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Gi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const J={debug:!!(globalThis&&Ot()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ut extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Hi extends Ut{}async function Ki(n,e,t){J.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),J.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){J.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{J.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw J.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Hi(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(J.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Gi();const Ji={url:ni,storageKey:ri,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ai,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ut(n,e,t){return await t()}const Q={};class ae{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ae.nextInstanceID,ae.nextInstanceID+=1,this.instanceID>0&&$()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Ji),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Wi({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=$t(i.fetch),this.lock=i.lock||ut,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:$()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ki:this.lock=ut,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Ot()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ct(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=ct(this.memoryStorage)),$()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Q[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Q[this.storageKey]=Object.assign(Object.assign({},Q[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Q[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Q[this.storageKey]=Object.assign(Object.assign({},Q[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Et}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ki(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),$()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:o}=await this._getSessionFromURL(t,s);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),gi(o)){const l=(e=o.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:r,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",r,"redirect type",a),await this._saveSession(r),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return y(t)?{error:t}:{error:new xt("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const o=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:M}),{data:r,error:a}=o;if(a||!r)return{data:{user:null,session:null},error:a};const l=r.session,c=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(y(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,s,i;try{let o;if("email"in e){const{email:u,password:h,options:d}=e;let g=null,p=null;this.flowType==="pkce"&&([g,p]=await H(this.storage,this.storageKey)),o=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:g,code_challenge_method:p},xform:M})}else if("phone"in e){const{phone:u,password:h,options:d}=e;o=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(i=d==null?void 0:d.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:M})}else throw new ge("You must provide either an email or phone number and a password");const{data:r,error:a}=o;if(a||!r)return{data:{user:null,session:null},error:a};const l=r.session,c=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(y(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:r,options:a}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:r,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:lt})}else if("phone"in e){const{phone:o,password:r,options:a}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:r,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:lt})}else throw new ge("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new de}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(y(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,i,o,r,a,l,c,u,h,d,g;let p,b;if("message"in e)p=e.message,b=e.signature;else{const{chain:m,wallet:S,statement:E,options:f}=e;let w;if($())if(typeof S=="object")w=S;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))w=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(f!=null&&f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=S}const O=new URL((t=f==null?void 0:f.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in w&&w.signIn){const k=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},f==null?void 0:f.signInWithSolana),{version:"1",domain:O.host,uri:O.href}),E?{statement:E}:null));let P;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")P=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)P=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)p=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),b=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${O.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...E?["",E,""]:[""],"Version: 1",`URI: ${O.href}`,`Issued At: ${(i=(s=f==null?void 0:f.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((o=f==null?void 0:f.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${f.signInWithSolana.notBefore}`]:[],...!((r=f==null?void 0:f.signInWithSolana)===null||r===void 0)&&r.expirationTime?[`Expiration Time: ${f.signInWithSolana.expirationTime}`]:[],...!((a=f==null?void 0:f.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${f.signInWithSolana.chainId}`]:[],...!((l=f==null?void 0:f.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${f.signInWithSolana.nonce}`]:[],...!((c=f==null?void 0:f.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${f.signInWithSolana.requestId}`]:[],...!((h=(u=f==null?void 0:f.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...f.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const k=await w.signMessage(new TextEncoder().encode(p),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=k}}try{const{data:m,error:S}=await v(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:wi(b)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:M});if(S)throw S;return!m||!m.session||!m.user?{data:{user:null,session:null},error:new de}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:Object.assign({},m),error:S})}catch(m){if(y(m))return{data:{user:null,session:null},error:m};throw m}}async _exchangeCodeForSession(e){const t=await V(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:o,error:r}=await v(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:M});if(await D(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new de}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:i??null}),error:r})}catch(o){if(y(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:o,nonce:r}=e,a=await v(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:o,nonce:r,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:M}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new de}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(y(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,o,r;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await H(this.storage,this.storageKey));const{error:h}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(o=l==null?void 0:l.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(r=l==null?void 0:l.channel)!==null&&r!==void 0?r:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new ge("You must provide either an email or phone number.")}catch(a){if(y(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let i,o;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:r,error:a}=await v(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:i,xform:M});if(a)throw a;if(!r)throw new Error("An error occurred on token verification.");const l=r.session,c=r.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(y(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let o=null,r=null;return this.flowType==="pkce"&&([o,r]=await H(this.storage,this.storageKey)),await v(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:r}),headers:this.headers,xform:Ni})}catch(o){if(y(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new R;const{error:i}=await v(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(y(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:o}=e,{error:r}=await v(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:r}}else if("phone"in e){const{phone:s,type:i,options:o}=e,{data:r,error:a}=await v(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:r==null?void 0:r.message_id},error:a}}throw new ge("You must provide either an email or phone number and a type")}catch(t){if(y(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await V(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Ae:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const r=await V(this.userStorage,this.storageKey+"-user");r!=null&&r.user?e.user=r.user:e.user=xe()}if(this.storage.isServer&&e.user){let r=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!r&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),r=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:L}):await this._useSession(async t=>{var s,i,o;const{data:r,error:a}=t;if(a)throw a;return!(!((s=r.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new R}:await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(i=r.session)===null||i===void 0?void 0:i.access_token)!==null&&o!==void 0?o:void 0,xform:L})})}catch(t){if(y(t))return di(t)&&(await this._removeSession(),await D(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:o}=s;if(o)throw o;if(!i.session)throw new R;const r=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await H(this.storage,this.storageKey));const{data:c,error:u}=await v(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:r.access_token,xform:L});if(u)throw u;return r.user=c.user,await this._saveSession(r),await this._notifyAllSubscribers("USER_UPDATED",r),{data:{user:r.user},error:null}})}catch(s){if(y(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new R;const t=Date.now()/1e3;let s=t,i=!0,o=null;const{payload:r}=Te(e.access_token);if(r.exp&&(s=r.exp,i=s<=t),i){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};o=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(y(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:r,error:a}=t;if(a)throw a;e=(s=r.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new R;const{session:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(y(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!$())throw new fe("No browser detected.");if(e.error||e.error_description||e.error_code)throw new fe(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new tt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new fe("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new tt("No code detected.");const{data:E,error:f}=await this._exchangeCodeForSession(e.code);if(f)throw f;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:E.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:o,refresh_token:r,expires_in:a,expires_at:l,token_type:c}=e;if(!o||!a||!r||!c)throw new fe("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;l&&(d=parseInt(l));const g=d-u;g*1e3<=X&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${h}s`);const p=d-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,u);const{data:b,error:m}=await this._getUser(o);if(m)throw m;const S={provider_token:s,provider_refresh_token:i,access_token:o,expires_in:h,expires_at:d,refresh_token:r,token_type:c,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:e.type},error:null}}catch(s){if(y(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await V(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:o}=t;if(o)return{error:o};const r=(s=i.session)===null||s===void 0?void 0:s.access_token;if(r){const{error:a}=await this.admin.signOut(r,e);if(a&&!(hi(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await D(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=_i(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:o},error:r}=t;if(r)throw r;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await H(this.storage,this.storageKey,!0));try{return await v(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(y(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(y(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async o=>{var r,a,l,c,u;const{data:h,error:d}=o;if(d)throw d;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await v(this.fetch,"GET",g,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return $()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(y(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:o,error:r}=t;if(r)throw r;return await v(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(y(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Ai(async i=>(i>0&&await Ci(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await v(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:M})),(i,o)=>{const r=200*Math.pow(2,i);return o&&Ee(o)&&Date.now()+r-s<X})}catch(s){if(this._debug(t,"error",s),y(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),$()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await V(this.storage,this.storageKey);if(i&&this.userStorage){let r=await V(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!r&&(r={user:i.user},await Y(this.userStorage,this.storageKey+"-user",r)),i.user=(e=r==null?void 0:r.user)!==null&&e!==void 0?e:xe()}else if(i&&!i.user&&!i.user){const r=await V(this.storage,this.storageKey+"-user");r&&(r!=null&&r.user)?(i.user=r.user,await D(this.storage,this.storageKey+"-user"),await Y(this.storage,this.storageKey,i)):i.user=xe()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const o=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Ae;if(this._debug(s,`session has${o?"":" not"} expired with margin of ${Ae}s`),o){if(this.autoRefreshToken&&i.refresh_token){const{error:r}=await this._callRefreshToken(i.refresh_token);r&&(console.error(r),Ee(r)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",r),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:r,error:a}=await this._getUser(i.access_token);!a&&(r!=null&&r.user)?(i.user=r.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new R;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new ke;const{data:o,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!o.session)throw new R;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const a={session:o.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(o){if(this._debug(i,"error",o),y(o)){const r={session:null,error:o};return Ee(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(r),r}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(o),o}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],r=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){o.push(l)}});if(await Promise.all(r),o.length>0){for(let a=0;a<o.length;a+=1)console.error(o[a]);throw o[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await Y(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const o=rt(i);await Y(this.storage,this.storageKey,o)}else{const i=rt(t);await Y(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await D(this.storage,this.storageKey),await D(this.storage,this.storageKey+"-code-verifier"),await D(this.storage,this.storageKey+"-user"),this.userStorage&&await D(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&$()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),X);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/X);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${X}ms, refresh threshold is ${Re} ticks`),i<=Re&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ut)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[o,r]=await H(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(r)}`});i.push(a.toString())}if(s!=null&&s.queryParams){const o=new URLSearchParams(s.queryParams);i.push(o.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:o}=t;return o?{data:null,error:o}:await v(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(y(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:o,error:r}=t;if(r)return{data:null,error:r};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await v(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=o==null?void 0:o.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(y(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const{data:r,error:a}=await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+r.expires_in},r)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",r),{data:r,error:a})})}catch(t){if(y(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:o}=t;return o?{data:null,error:o}:await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(y(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(r=>r.factor_type==="totp"&&r.status==="verified"),o=s.filter(r=>r.factor_type==="phone"&&r.status==="verified");return{data:{all:s,totp:i,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:o}=e;if(o)return{data:null,error:o};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:r}=Te(i.access_token);let a=null;r.aal&&(a=r.aal);let l=a;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const u=r.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+ci>i)return s;const{data:o,error:r}=await v(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=i,s=o.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:g,error:p}=await this.getSession();if(p||!g.session)return{data:null,error:p};s=g.session.access_token}const{header:i,payload:o,signature:r,raw:{header:a,payload:l}}=Te(s);t!=null&&t.allowExpired||Ui(o.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:o,header:i,signature:r},error:null}}const u=Mi(i.alg),h=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,r,bi(`${a}.${l}`)))throw new Fe("Invalid JWT signature");return{data:{claims:o,header:i,signature:r},error:null}}catch(s){if(y(s))return{data:null,error:s};throw s}}}ae.nextInstanceID=0;const Qi=ae;class Xi extends Qi{constructor(e){super(e)}}var Yi=globalThis&&globalThis.__awaiter||function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(u){try{c(s.next(u))}catch(h){r(h)}}function l(u){try{c(s.throw(u))}catch(h){r(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((s=s.apply(n,e||[])).next())})};let Zi=class{constructor(e,t,s){var i,o,r;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=ii(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:Js,realtime:Xs,auth:Object.assign(Object.assign({},Qs),{storageKey:c}),global:Ks},h=oi(s??{},u);this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((r=h.auth)!==null&&r!==void 0?r:{},this.headers,h.global.fetch),this.fetch=ti(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new ps(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new Ws(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new qt(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Yi(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:o,flowType:r,lock:a,debug:l},c,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Xi({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),c),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:r,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new $s(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const eo=(n,e,t)=>new Zi(n,e,t);function to(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}to()&&console.warn("‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");class so{constructor(){this.supabaseUrl="https://xseeptbspcjnqmumgldz.supabase.co",this.supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzZWVwdGJzcGNqbnFtdW1nbGR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5Mjk5NDUsImV4cCI6MjA3MDUwNTk0NX0.JAJArWYvk1f_ZX19J8NQsmQlODhqIwN-BbnE3mgdO-g",this.supabase=null,this.telegramId=null,this.isInitialized=!1}async init(e){try{return this.telegramId=e,this.supabase=eo(this.supabaseUrl,this.supabaseKey),this.isInitialized=!0,console.log("‚úì Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω"),!0}catch(t){return console.error("‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase:",t),!1}}async saveGameData(e){if(!this.isInitialized)return console.error("Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"),!1;try{const t={telegram_id:this.telegramId,money:e.money||0,click_value:e.clickValue||1,base_auto_click_value:e.baseAutoClickValue||0,upgrade_prices:e.upgradePrices||{},upgrade_stats:e.upgradeStats||{},planet_system:e.planetSystem||{},boost_system:e.boostSystem||{},referral_system:e.referralSystem||{},timestamp:e.timestamp||Date.now(),last_updated:new Date().toISOString()},{data:s,error:i}=await this.supabase.from("player_data").upsert(t,{onConflict:"telegram_id",returning:"minimal"});return i?(console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:",i),!1):(console.log("‚úì –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Supabase"),!0)}catch(t){return console.error("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:",t),!1}}async loadGameData(){if(!this.isInitialized)return console.error("Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"),null;try{const{data:e,error:t}=await this.supabase.from("player_data").select("*").eq("telegram_id",this.telegramId).single();return t?t.code==="PGRST116"?(console.log("–ù–æ–≤—ã–π –∏–≥—Ä–æ–∫ - –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç"),null):(console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:",t),null):(console.log("‚úì –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Supabase"),{money:e.money||0,clickValue:e.click_value||1,baseAutoClickValue:e.base_auto_click_value||0,upgradePrices:e.upgrade_prices||{},upgradeStats:e.upgrade_stats||{},planetSystem:e.planet_system||{},boostSystem:e.boost_system||{},referralSystem:e.referral_system||{},timestamp:e.timestamp||Date.now()})}catch(e){return console.error("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:",e),null}}async savePurchase(e,t,s){if(!this.isInitialized)return console.error("Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"),!1;try{const{data:i,error:o}=await this.supabase.from("purchases").insert({telegram_id:this.telegramId,purchase_type:e,amount:t,cost:s,timestamp:new Date().toISOString()});return o?(console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏:",o),!1):(console.log("‚úì –ü–æ–∫—É–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞"),!0)}catch(i){return console.error("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–∫—É–ø–∫–∏:",i),!1}}async getPurchaseHistory(){if(!this.isInitialized)return console.error("Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"),[];try{const{data:e,error:t}=await this.supabase.from("purchases").select("*").eq("telegram_id",this.telegramId).order("timestamp",{ascending:!1});return t?(console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:",t),[]):e||[]}catch(e){return console.error("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏:",e),[]}}}class io{constructor(){this.planets={},this.initializePlanetConfigs()}initializePlanetConfigs(){this.addPlanetConfig("earth",{name:"–ó–µ–º–ª—è",description:"–ù–∞—à —Ä–æ–¥–Ω–æ–π –¥–æ–º",price:0,boost:1,image:"Plantes/Sun System/Earth.png",glow:"radial-gradient(circle, rgba(74, 144, 226, 0.3) 0%, transparent 70%)",system:"solar"}),this.addPlanetConfig("mars",{name:"–ú–∞—Ä—Å",description:"–ö—Ä–∞—Å–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞",price:1e3,boost:1.5,image:"Plantes/Sun System/Mars.png",glow:"radial-gradient(circle, rgba(255, 100, 100, 0.3) 0%, transparent 70%)",system:"solar"}),this.addPlanetConfig("venus",{name:"–í–µ–Ω–µ—Ä–∞",description:"–£—Ç—Ä–µ–Ω–Ω—è—è –∑–≤–µ–∑–¥–∞",price:5e3,boost:2,image:"Plantes/Sun System/Venus.png",glow:"radial-gradient(circle, rgba(255, 200, 100, 0.3) 0%, transparent 70%)",system:"solar"}),this.addPlanetConfig("jupiter",{name:"–Æ–ø–∏—Ç–µ—Ä",description:"–ì–∞–∑–æ–≤—ã–π –≥–∏–≥–∞–Ω—Ç",price:25e3,boost:3,image:"Plantes/Sun System/Jupiter.png",glow:"radial-gradient(circle, rgba(255, 150, 50, 0.3) 0%, transparent 70%)",system:"solar"}),this.addPlanetConfig("saturn",{name:"–°–∞—Ç—É—Ä–Ω",description:"–ü–ª–∞–Ω–µ—Ç–∞ —Å –∫–æ–ª—å—Ü–∞–º–∏",price:1e5,boost:4,image:"Plantes/Sun System/Saturn.png",glow:"radial-gradient(circle, rgba(255, 200, 100, 0.3) 0%, transparent 70%)",system:"solar"}),this.addPlanetConfig("neptune",{name:"–ù–µ–ø—Ç—É–Ω",description:"–õ–µ–¥—è–Ω–æ–π –≥–∏–≥–∞–Ω—Ç",price:5e5,boost:5,image:"Plantes/Sun System/Neptune.png",glow:"radial-gradient(circle, rgba(100, 150, 255, 0.3) 0%, transparent 70%)",system:"solar"}),this.addPlanetConfig("sun",{name:"–°–æ–ª–Ω—Ü–µ",description:"–ù–∞—à–∞ –∑–≤–µ–∑–¥–∞",price:2e6,boost:10,image:"Plantes/Sun System/sun.png",glow:"radial-gradient(circle, rgba(255, 200, 0, 0.5) 0%, transparent 70%)",system:"solar"}),this.addPlanetConfig("proxima",{name:"–ü—Ä–æ–∫—Å–∏–º–∞ b",description:"–≠–∫–∑–æ–ø–ª–∞–Ω–µ—Ç–∞",price:1e7,boost:15,image:"Plantes/alpha/Proxima.png",glow:"radial-gradient(circle, rgba(200, 100, 255, 0.3) 0%, transparent 70%)",system:"alpha_centauri"}),this.addPlanetConfig("kepler",{name:"–ö–µ–ø–ª–µ—Ä-442b",description:"–°—É–ø–µ—Ä–∑–µ–º–ª—è",price:25e6,boost:25,image:"Plantes/alpha/Kepler.png",glow:"radial-gradient(circle, rgba(100, 200, 255, 0.3) 0%, transparent 70%)",system:"alpha_centauri"}),this.addPlanetConfig("gliese",{name:"–ì–ª–∏–∑–µ 581g",description:"–°—É–ø–µ—Ä–∑–µ–º–ª—è –≤ –æ–±–∏—Ç–∞–µ–º–æ–π –∑–æ–Ω–µ",price:5e7,boost:30,image:"Plantes/alpha/Gliese.png",glow:"radial-gradient(circle, rgba(100, 200, 255, 0.3) 0%, transparent 70%)",system:"alpha_centauri"}),this.addPlanetConfig("trappist",{name:"TRAPPIST-1e",description:"–≠–∫–∑–æ–ø–ª–∞–Ω–µ—Ç–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ –∫–∞—Ä–ª–∏–∫–∞ —Å –ø—Ä–∏–ª–∏–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π",price:1e8,boost:35,image:"Plantes/alpha/TRAPPIST.png",glow:"radial-gradient(circle, rgba(150, 100, 200, 0.3) 0%, transparent 70%)",system:"alpha_centauri"}),this.addPlanetConfig("HD 40307g",{name:"HD 40307g",description:"–°—É–ø–µ—Ä–∑–µ–º–ª—è –≤ –æ–±–∏—Ç–∞–µ–º–æ–π –∑–æ–Ω–µ",price:75e6,boost:28,image:"Plantes/alpha/HD40307g.png",glow:"radial-gradient(circle, rgba(100, 200, 255, 0.3) 0%, transparent 70%)",system:"alpha_centauri"}),this.addPlanetConfig("Wolf 1061c",{name:"Wolf 1061c",description:"–≠–∫–∑–æ–ø–ª–∞–Ω–µ—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ Wolf 1061",price:12e7,boost:32,image:"Plantes/alpha/Wolf1061c.png",glow:"radial-gradient(circle, rgba(150, 100, 200, 0.3) 0%, transparent 70%)",system:"alpha_centauri"}),this.addPlanetConfig("alpha_centauri_A",{name:"–ê–ª—å—Ñ–∞ –¶–µ–Ω—Ç–∞–≤—Ä–∞ A",description:"–°–≤–µ—Ç–∏–ª–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –ê–ª—å—Ñ–∞ –¶–µ–Ω—Ç–∞–≤—Ä–∞",price:15e7,boost:35,image:"Plantes/alpha/AlphaCentauriA.png",glow:"radial-gradient(circle, rgba(150, 100, 200, 0.3) 0%, transparent 70%)",system:"alpha_centauri"})}addPlanetConfig(e,t){this.planets[e]={...t,id:e,unlocked:e==="earth",imagePath:t.image,imageLoaded:!1}}loadPlanetImage(e){const t=this.planets[e];return!t||t.imageLoaded?Promise.resolve():new Promise(s=>{if(!t.imagePath){t.imageLoaded=!0,s();return}const i=new Image;i.onload=()=>{t.imageLoaded=!0,s()},i.onerror=()=>{console.warn(`Failed to load image for planet ${e}: ${t.imagePath}`),t.imagePath=null,t.imageLoaded=!0,s()},i.src=t.imagePath})}async loadAllPlanetImages(){const e=Object.keys(this.planets).map(t=>this.loadPlanetImage(t));try{await Promise.all(e),console.log("All planet images loaded")}catch(t){console.warn("Some planet images failed to load:",t)}}getPlanet(e){const t=this.planets[e]||null;return console.log("getPlanet result for",e,":",t?t.boost:"not found"),t}getAllPlanets(){return this.planets}getPlanetsBySystem(e){return Object.values(this.planets).filter(t=>t.system===e)}getAvailableSystems(){const e=new Set;return Object.values(this.planets).forEach(t=>{e.add(t.system)}),Array.from(e)}planetExists(e){return e in this.planets}getNextPlanetInSystem(e){const t=this.planets[e];if(!t)return null;const s=this.getPlanetsBySystem(t.system),i=s.findIndex(o=>o.id===e);return i===-1||i===s.length-1?null:s[i+1]}getSystemStartPlanet(e){const t=this.getPlanetsBySystem(e);return t.length===0?null:(t.sort((s,i)=>s.price-i.price),t[0])}clonePlanetData(e){const t=this.planets[e];return t?{...t}:null}}class oo{constructor(){this.planetElement=null,this.currentPlanetId=null}init(){return this.planetElement=document.getElementById("planet-earth"),this.planetElement?!0:(console.error("Planet element not found!"),!1)}updatePlanetVisual(e,t){if(!this.planetElement||!t){console.warn("Cannot update planet visual: missing element or data");return}const s=this.planetElement.querySelector(".planet-surface"),i=this.planetElement.querySelector(".planet-glow");s&&t.image&&(s.style.backgroundImage=`url('${t.image}')`,console.log(`Updated planet visual for ${e}: ${t.image}`)),i&&t.glow&&(i.style.background=t.glow,console.log(`Updated planet glow for ${e}`)),this.currentPlanetId=e}createClickEffect(e){const t=document.createElement("div");t.className="click-effect",t.style.cssText=`
            position: fixed;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.7);
            pointer-events: none;
            transform: translate(-50%, -50%);
            animation: click-ripple 0.6s linear;
            z-index: 1000;
        `;const s=e.clientX,i=e.clientY;t.style.left=s+"px",t.style.top=i+"px",document.body.appendChild(t),setTimeout(()=>t.remove(),600)}showMoneyPopup(e,t){const s=document.createElement("div");s.className="money-popup",s.textContent=`+${this.formatNumber(t)}`,s.style.cssText=`
            position: fixed;
            color: #4CAF50;
            font-weight: bold;
            font-size: 18px;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            z-index: 1000;
        `;const i=e.clientX,o=e.clientY;s.style.left=i+"px",s.style.top=o+"px",document.body.appendChild(s),setTimeout(()=>s.remove(),1e3)}formatNumber(e){return isNaN(e)||e===null||e===void 0?"0":(e=Math.floor(e),e<0?"-"+this.formatNumber(Math.abs(e)):e>=1e12?(e/1e12).toFixed(2)+"T":e>=1e9?(e/1e9).toFixed(2)+"B":e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString())}getCurrentPlanetId(){return this.currentPlanetId}}class no{constructor(){console.log("PlanetManager constructor called"),this.planetData=new io,this.planetRenderer=new oo,this.currentPlanet="earth",this.unlockedPlanets=["earth"],this.prestigeSystem=null,console.log("PlanetManager constructor completed, initial state:",{currentPlanet:this.currentPlanet,unlockedPlanets:this.unlockedPlanets,prestigeSystem:this.prestigeSystem})}async init(){return console.log("Initializing PlanetManager..."),console.log("Initializing planet renderer..."),this.planetRenderer.init()?(console.log("Planet renderer initialized successfully"),console.log("Loading all planet images..."),await this.planetData.loadAllPlanetImages(),console.log("All planet images loaded"),console.log("Updating current planet visual..."),this.updateCurrentPlanetVisual(),console.log("Current planet visual updated"),console.log("PlanetManager initialized successfully"),!0):(console.error("Failed to initialize planet renderer"),!1)}setPrestigeSystem(e){console.log("setPrestigeSystem called with:",e),this.prestigeSystem=e,this.syncWithPrestigeSystem()}syncWithPrestigeSystem(){if(console.log("syncWithPrestigeSystem called, prestigeSystem:",this.prestigeSystem),!this.prestigeSystem){console.log("No prestige system to sync with");return}const e=this.prestigeSystem.getCurrentPlanets();console.log("Current planets from prestige system:",e),this.unlockedPlanets=[],Object.keys(e).forEach(s=>{e[s].unlocked&&this.unlockedPlanets.push(s)});const t=this.prestigeSystem.getStartPlanet(this.prestigeSystem.currentSystem);console.log("Start planet from prestige system:",t,"is unlocked:",this.isPlanetUnlocked(t)),t&&this.isPlanetUnlocked(t)&&(this.currentPlanet=t),console.log("Synced with prestige system:",{unlockedPlanets:this.unlockedPlanets,currentPlanet:this.currentPlanet})}getPlanet(e){console.log("getPlanet called with:",e);const t=this.planetData.getPlanet(e);return console.log("getPlanet result for",e,":",t),t}getAllPlanets(){console.log("getAllPlanets called");const e=this.planetData.getAllPlanets();return console.log("getAllPlanets result:",e),e}getUnlockedPlanets(){return console.log("getUnlockedPlanets called, returning:",this.unlockedPlanets),[...this.unlockedPlanets]}isPlanetUnlocked(e){console.log("isPlanetUnlocked called with:",e,"unlocked planets:",this.unlockedPlanets);const t=this.unlockedPlanets.includes(e);return console.log("isPlanetUnlocked result for",e,":",t,"unlocked planets:",this.unlockedPlanets),t}unlockPlanet(e){if(console.log("unlockPlanet called with:",e,"current unlocked planets:",this.unlockedPlanets),!this.planetData.planetExists(e))return console.error(`Planet ${e} does not exist`),!1;if(this.isPlanetUnlocked(e))return console.log(`Planet ${e} already unlocked`),!1;if(this.unlockedPlanets.push(e),console.log("Planet unlocked, new unlocked planets:",this.unlockedPlanets),this.prestigeSystem){const t=this.prestigeSystem.getCurrentPlanets();t[e]&&(t[e].unlocked=!0,this.prestigeSystem.savePrestigeData())}return console.log(`Planet ${e} unlocked`),!0}changePlanet(e){return console.log("changePlanet called with:",e,"current planet:",this.currentPlanet),this.isPlanetUnlocked(e)?(this.currentPlanet=e,this.updateCurrentPlanetVisual(),console.log(`Changed to planet: ${e}`),!0):(console.error(`Planet ${e} is not unlocked`),!1)}updateCurrentPlanetVisual(){console.log("updateCurrentPlanetVisual called, current planet:",this.currentPlanet);const e=this.planetData.getPlanet(this.currentPlanet);e&&this.planetRenderer.updatePlanetVisual(this.currentPlanet,e)}getCurrentPlanet(){return console.log("getCurrentPlanet called, returning:",this.currentPlanet),this.currentPlanet}getCurrentPlanetBoost(){console.log("getCurrentPlanetBoost called, current planet:",this.currentPlanet);const e=this.planetData.getPlanet(this.currentPlanet),t=e?e.boost:1;return console.log("getCurrentPlanetBoost result for",this.currentPlanet,":",t,"planet:",e),t}getTotalPlanetBoost(){console.log("getTotalPlanetBoost called, unlocked planets:",this.unlockedPlanets);let e=1;return this.unlockedPlanets.forEach(t=>{const s=this.planetData.getPlanet(t);s&&t!=="earth"?(e+=s.boost-1,console.log("Adding boost from",t,":",s.boost,"totalBoost now:",e)):t==="earth"?console.log("Skipping earth planet boost calculation"):console.log("Planet not found or invalid:",t)}),console.log("getTotalPlanetBoost result:",e,"unlocked planets:",this.unlockedPlanets),this.unlockedPlanets.forEach(t=>{const s=this.planetData.getPlanet(t);console.log("Planet boost for",t,":",s?s.boost:"not found")}),e}buyPlanet(e,t){console.log("buyPlanet called with:",e,"playerMoney:",t);const s=this.planetData.getPlanet(e);return console.log("Planet data:",s),s?this.isPlanetUnlocked(e)?(console.log("Planet already unlocked, changing to it"),this.changePlanet(e),{success:!0,message:`–ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É ${s.name}`,cost:0}):t<s.price?(console.log("Not enough money to buy planet"),{success:!1,message:`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥! –ù—É–∂–Ω–æ ${this.formatNumber(s.price)}`}):(console.log("Unlocking and changing to planet"),this.unlockPlanet(e),this.changePlanet(e),{success:!0,message:`–ü–ª–∞–Ω–µ—Ç–∞ ${s.name} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!`,cost:s.price}):(console.log("Planet not found"),{success:!1,message:"–ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"})}getMapData(){console.log("getMapData called");const e=this.planetData.getAllPlanets();console.log("All planets:",e);const t=Object.keys(e).map(s=>{const i=e[s],o={id:s,name:i.name,description:i.description,price:i.price,boost:i.boost,image:i.imagePath,system:i.system,unlocked:this.isPlanetUnlocked(s),current:s===this.currentPlanet};return console.log("Map data for",s,":",o),o});return console.log("getMapData result:",t),t}createClickEffect(e){console.log("createClickEffect called with event:",e),this.planetRenderer.createClickEffect(e)}showMoneyPopup(e,t){console.log("showMoneyPopup called with amount:",t),this.planetRenderer.showMoneyPopup(e,t)}formatNumber(e){console.log("formatNumber called with:",e);const t=this.planetRenderer.formatNumber(e);return console.log("formatNumber result:",t),t}saveState(){const e={currentPlanet:this.currentPlanet,unlockedPlanets:[...this.unlockedPlanets]};return console.log("saveState result:",e),e}loadState(e){console.log("loadState called with:",e),e.currentPlanet&&(this.currentPlanet=e.currentPlanet),e.unlockedPlanets&&(this.unlockedPlanets=[...e.unlockedPlanets]),this.updateCurrentPlanetVisual(),console.log("loadState completed, new state:",{currentPlanet:this.currentPlanet,unlockedPlanets:this.unlockedPlanets})}reset(){console.log("reset called, old state:",{currentPlanet:this.currentPlanet,unlockedPlanets:this.unlockedPlanets}),this.currentPlanet="earth",this.unlockedPlanets=["earth"],this.updateCurrentPlanetVisual(),console.log("Planet system reset")}}class ro{constructor(){console.log("GameState constructor called"),this.money=0,this.clickValue=1,this.baseAutoClickValue=0,this.autoClickValue=0,this.gameStartTime=Date.now(),this.totalClicks=0,this.totalEarned=0,console.log("GameState constructor completed, initial state:",{money:this.money,clickValue:this.clickValue,baseAutoClickValue:this.baseAutoClickValue,autoClickValue:this.autoClickValue,gameStartTime:this.gameStartTime,totalClicks:this.totalClicks,totalEarned:this.totalEarned})}addMoney(e){if(console.log("addMoney called with amount:",e,"current money:",this.money),e<=0){console.log("addMoney: amount is 0 or less, returning");return}this.money+=e,this.totalEarned+=e,this.updateStatistics(),console.log("Money after adding:",this.money,"total earned:",this.totalEarned)}spendMoney(e){return console.log("spendMoney called with amount:",e,"current money:",this.money),e<=0||this.money<e?(console.log("spendMoney returning false"),!1):(this.money-=e,console.log("spendMoney success, new money:",this.money),!0)}canAfford(e){console.log("canAfford called with amount:",e,"current money:",this.money);const t=this.money>=e;return console.log("canAfford result:",t),t}getMoney(){return console.log("getMoney called, returning:",this.money),this.money}setMoney(e){console.log("setMoney called with amount:",e,"old money:",this.money),this.money=Math.max(0,e),console.log("setMoney new money:",this.money)}getClickValue(){return console.log("getClickValue called, returning:",this.clickValue),this.clickValue}setClickValue(e){console.log("setClickValue called with:",e,"old value:",this.clickValue),this.clickValue=Math.max(1,e),console.log("setClickValue new value:",this.clickValue)}getAutoClickValue(){return console.log("getAutoClickValue called, returning:",this.autoClickValue),this.autoClickValue}setAutoClickValue(e){console.log("setAutoClickValue called with:",e,"old value:",this.autoClickValue),this.autoClickValue=Math.max(0,e),console.log("setAutoClickValue new value:",this.autoClickValue)}getBaseAutoClickValue(){return console.log("getBaseAutoClickValue called, returning:",this.baseAutoClickValue),this.baseAutoClickValue}setBaseAutoClickValue(e){console.log("setBaseAutoClickValue called with:",e,"old value:",this.baseAutoClickValue),this.baseAutoClickValue=Math.max(0,e),console.log("setBaseAutoClickValue new value:",this.baseAutoClickValue)}increaseBaseAutoClick(e){console.log("increaseBaseAutoClick called with:",e,"old value:",this.baseAutoClickValue),this.baseAutoClickValue+=e,console.log("increaseBaseAutoClick new value:",this.baseAutoClickValue)}registerClick(){console.log("registerClick called, old totalClicks:",this.totalClicks),this.totalClicks++,console.log("registerClick new totalClicks:",this.totalClicks)}getGameStatistics(){console.log("getGameStatistics called");const e=Date.now()-this.gameStartTime,t=Math.floor(e/6e4),s={totalClicks:this.totalClicks,totalEarned:this.totalEarned,playTimeMinutes:t,clicksPerMinute:t>0?Math.round(this.totalClicks/t):0,earningsPerMinute:t>0?Math.round(this.totalEarned/t):0};return console.log("getGameStatistics result:",s),s}updateStatistics(){console.log("updateStatistics called")}saveState(){const e={money:this.money,clickValue:this.clickValue,baseAutoClickValue:this.baseAutoClickValue,autoClickValue:this.autoClickValue,gameStartTime:this.gameStartTime,totalClicks:this.totalClicks,totalEarned:this.totalEarned};return console.log("saveState result:",e),e}loadState(e){if(console.log("loadState called with:",e),!e){console.log("loadState: no state provided");return}this.money=e.money||0,this.clickValue=e.clickValue||1,this.baseAutoClickValue=e.baseAutoClickValue||0,this.autoClickValue=e.autoClickValue||0,this.gameStartTime=e.gameStartTime||Date.now(),this.totalClicks=e.totalClicks||0,this.totalEarned=e.totalEarned||0,console.log("loadState completed, new state:",{money:this.money,clickValue:this.clickValue,baseAutoClickValue:this.baseAutoClickValue,autoClickValue:this.autoClickValue,gameStartTime:this.gameStartTime,totalClicks:this.totalClicks,totalEarned:this.totalEarned})}reset(){console.log("reset called, old state:",{money:this.money,clickValue:this.clickValue,baseAutoClickValue:this.baseAutoClickValue,autoClickValue:this.autoClickValue,gameStartTime:this.gameStartTime,totalClicks:this.totalClicks,totalEarned:this.totalEarned}),this.money=0,this.clickValue=1,this.baseAutoClickValue=0,this.autoClickValue=0,this.gameStartTime=Date.now(),this.totalClicks=0,this.totalEarned=0,console.log("reset completed, new state:",{money:this.money,clickValue:this.clickValue,baseAutoClickValue:this.baseAutoClickValue,autoClickValue:this.autoClickValue,gameStartTime:this.gameStartTime,totalClicks:this.totalClicks,totalEarned:this.totalEarned})}formatNumber(e){if(console.log("formatNumber called with:",e),isNaN(e)||e===null||e===void 0)return console.log("formatNumber returning 0 due to invalid input"),"0";if(e=Math.floor(e),console.log("formatNumber after Math.floor:",e),e<0){const s="-"+this.formatNumber(Math.abs(e));return console.log("formatNumber returning negative result:",s),s}if(e>=1e12){const s=(e/1e12).toFixed(2)+"T";return console.log("formatNumber returning T result:",s),s}if(e>=1e9){const s=(e/1e9).toFixed(2)+"B";return console.log("formatNumber returning B result:",s),s}if(e>=1e6){const s=(e/1e6).toFixed(2)+"M";return console.log("formatNumber returning M result:",s),s}if(e>=1e3){const s=(e/1e3).toFixed(1)+"K";return console.log("formatNumber returning K result:",s),s}const t=e.toString();return console.log("formatNumber returning base result:",t),t}}class ao{constructor(){console.log("ClickHandler constructor called"),this.clickDebounce=!1,this.debounceTime=50,this.eventListeners=[],console.log("ClickHandler initialized with default values")}init(e,t){return console.log("ClickHandler init called with planetElement:",e),e?(console.log("Adding click event listener"),this.addEventListener(e,"click",s=>{this.handleClick(s,t)}),console.log("Click handler initialized"),!0):(console.error("Planet element not provided for click handler"),!1)}handleClick(e,t){if(console.log("handleClick called with event:",e,"debounce state:",this.clickDebounce),this.clickDebounce){console.log("Click is debouncing, skipping");return}t&&typeof t=="function"&&(console.log("Calling click callback"),t(e)),console.log("Setting debounce to true"),this.clickDebounce=!0,setTimeout(()=>{console.log("Debounce timeout expired, setting debounce to false"),this.clickDebounce=!1},this.debounceTime)}addEventListener(e,t,s){if(console.log("addEventListener called with element:",e,"event:",t),!e){console.log("Element is null, skipping addEventListener");return}console.log("Adding event listener to element"),e.addEventListener(t,s),this.eventListeners.push({element:e,event:t,handler:s}),console.log("Event listener added, total listeners:",this.eventListeners.length)}cleanup(){console.log("cleanup called, removing event listeners, count:",this.eventListeners.length),this.eventListeners.forEach(({element:e,event:t,handler:s})=>{console.log("Removing event listener for event:",t),e.removeEventListener(t,s)}),this.eventListeners=[],console.log("All event listeners removed")}setDebounceTime(e){console.log("setDebounceTime called with time:",e),this.debounceTime=Math.max(10,e),console.log("Debounce time set to:",this.debounceTime)}isDebouncing(){return console.log("isDebouncing result:",this.clickDebounce),this.clickDebounce}}class lo{constructor(){this.interval=null,this.isRunning=!1,this.tickRate=1e3,this.callbacks={onTick:null,onStart:null,onStop:null}}start(e){if(this.isRunning){console.log("AutoClicker already running");return}this.callbacks.onTick=e,this.interval=setInterval(()=>{this.tick()},this.tickRate),this.isRunning=!0,this.callbacks.onStart&&this.callbacks.onStart(),console.log("AutoClicker started")}stop(){this.isRunning&&(this.interval&&(clearInterval(this.interval),this.interval=null),this.isRunning=!1,this.callbacks.onStop&&this.callbacks.onStop(),console.log("AutoClicker stopped"))}tick(){this.callbacks.onTick&&typeof this.callbacks.onTick=="function"&&this.callbacks.onTick()}isActive(){return this.isRunning}setTickRate(e){const t=Math.max(100,e);if(t!==this.tickRate&&(this.tickRate=t,this.isRunning)){const s=this.callbacks.onTick;this.stop(),this.start(s)}}getTickRate(){return this.tickRate}setCallbacks(e){e.onTick&&(this.callbacks.onTick=e.onTick),e.onStart&&(this.callbacks.onStart=e.onStart),e.onStop&&(this.callbacks.onStop=e.onStop)}cleanup(){this.stop(),this.callbacks={onTick:null,onStart:null,onStop:null}}getStats(){return{isRunning:this.isRunning,tickRate:this.tickRate,hasTickCallback:!!this.callbacks.onTick}}}class co{constructor(){console.log("DisplayManager constructor called"),this.elements={},this.updateCallbacks=[],this.isInitialized=!1,console.log("DisplayManager constructor completed, initial state:",{elements:this.elements,updateCallbacks:this.updateCallbacks,isInitialized:this.isInitialized})}init(){console.log("DisplayManager init called"),this.elements={moneyDisplay:document.getElementById("money-amount"),incomeDisplay:document.getElementById("income-amount"),boostDisplay:document.getElementById("boost-display"),boostMultiplier:document.getElementById("boost-multiplier"),clickUpgradeBtn:document.getElementById("buy-click"),autoUpgradeBtn:document.getElementById("buy-auto"),satelliteUpgradeBtn:document.getElementById("buy-satellite"),spaceshipUpgradeBtn:document.getElementById("buy-spaceship"),rebirthBtn:document.getElementById("rebirth-btn"),watchAdBtn:document.getElementById("watch-ad-btn"),permanentBoostBtn:document.getElementById("buy-permanent-boost")},console.log("Elements loaded:",this.elements);const t=["moneyDisplay","incomeDisplay"].filter(s=>!this.elements[s]);return console.log("Missing critical elements:",t),t.length>0?(console.error("Missing critical UI elements:",t),!1):(this.isInitialized=!0,console.log("DisplayManager initialized"),!0)}updateMoneyDisplay(e){if(console.log("updateMoneyDisplay called with money:",e),console.log("this.elements.moneyDisplay:",this.elements.moneyDisplay),this.elements.moneyDisplay){const t=this.formatNumber(e);console.log("Formatted money:",t),this.elements.moneyDisplay.textContent=t,console.log("Money display updated to:",this.elements.moneyDisplay.textContent)}else console.log("Money display element not found")}updateIncomeDisplay(e){console.log("updateIncomeDisplay called with income:",e),this.elements.incomeDisplay&&(this.elements.incomeDisplay.textContent=this.formatNumber(e)+"/—Å–µ–∫")}updateBoostDisplay(e,t=!1){if(console.log("updateBoostDisplay called with multiplier:",e,"hasActiveBoost:",t),this.elements.boostMultiplier){const s=`x${e.toFixed(1)}`;this.elements.boostMultiplier.textContent=s}this.elements.boostDisplay&&this.elements.boostDisplay.classList.toggle("active",t||e>1)}updateClickUpgradeButton(e,t){console.log("updateClickUpgradeButton called with price:",e,"canAfford:",t);const s=this.elements.clickUpgradeBtn,i=document.getElementById("click-price");if(!s){console.error("Click upgrade button not found!");return}if(i){const o=this.formatNumber(e);console.log("Updating click upgrade price from",i.textContent,"to",o),i.textContent=o}else console.error("Click price element not found!");s.disabled=!t,s.classList.toggle("affordable",t)}updateAutoUpgradeButton(e,t){console.log("updateAutoUpgradeButton called with price:",e,"canAfford:",t);const s=this.elements.autoUpgradeBtn,i=document.getElementById("auto-price");if(!s){console.error("Auto upgrade button not found!");return}if(i){const o=this.formatNumber(e);console.log("Updating auto upgrade price from",i.textContent,"to",o),i.textContent=o}else console.error("Auto price element not found!");s.disabled=!t,s.classList.toggle("affordable",t)}updateSatelliteButton(e,t,s,i){console.log("updateSatelliteButton called with price:",e,"level:",t,"maxLevel:",s,"canAfford:",i);const o=this.elements.satelliteUpgradeBtn,r=document.getElementById("satellite-price"),a=document.getElementById("satellite-level");if(!o){console.error("Satellite upgrade button not found!");return}if(r){const l=t>=s?"–ú–ê–ö–°":this.formatNumber(e);console.log("Updating satellite price from",r.textContent,"to",l),r.textContent=l}else console.error("Satellite price element not found!");a&&(a.textContent=t),o.disabled=!i||t>=s,o.classList.toggle("affordable",i&&t<s),o.classList.toggle("maxed",t>=s)}updateSpaceshipButton(e,t,s,i){console.log("updateSpaceshipButton called with price:",e,"level:",t,"maxLevel:",s,"canAfford:",i);const o=this.elements.spaceshipUpgradeBtn,r=document.getElementById("spaceship-price"),a=document.getElementById("spaceship-level");if(!o){console.error("Spaceship upgrade button not found!");return}if(r){const l=t>=s?"–ú–ê–ö–°":this.formatNumber(e);console.log("Updating spaceship price from",r.textContent,"to",l),r.textContent=l}else console.error("Spaceship price element not found!");a&&(a.textContent=t),o.disabled=!i||t>=s,o.classList.toggle("affordable",i&&t<s),o.classList.toggle("maxed",t>=s)}updateRebirthButton(e,t){console.log("updateRebirthButton called with canRebirth:",e,"prestigePoints:",t);const s=this.elements.rebirthBtn;if(!s)return;const i=s.querySelector(".prestige-points");i&&(i.textContent=`+${this.formatNumber(t)} PP`),s.disabled=!e,s.classList.toggle("available",e)}updateAdButton(e,t,s){console.log("updateAdButton called with canWatch:",e,"timeLeft:",t,"hasActiveBoost:",s);const i=this.elements.watchAdBtn;i&&(s?(i.disabled=!0,i.textContent="–ë—É—Å—Ç –∞–∫—Ç–∏–≤–µ–Ω"):e?(i.disabled=!1,i.textContent="–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É (x2 –±—É—Å—Ç)"):(i.disabled=!0,i.textContent=`–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ${t} —Å–µ–∫`))}updateAll(e){if(console.log("updateAll called with gameData:",e),!this.isInitialized){console.log("DisplayManager not initialized, skipping update");return}if(console.log("Updating money and income displays"),this.updateMoneyDisplay(e.money),this.updateIncomeDisplay(e.income),e.boost&&(console.log("Updating boost display"),this.updateBoostDisplay(e.boost.totalMultiplier,e.boost.hasActiveBoost)),e.upgrades){const{upgrades:t}=e;console.log("Updating upgrade buttons with upgrades:",t),t.click&&(console.log("Updating click upgrade button"),this.updateClickUpgradeButton(t.click.price,t.click.canAfford)),t.auto&&(console.log("Updating auto upgrade button"),this.updateAutoUpgradeButton(t.auto.price,t.auto.canAfford)),t.satellite&&(console.log("Updating satellite button"),this.updateSatelliteButton(t.satellite.price,t.satellite.level,t.satellite.maxLevel,t.satellite.canAfford)),t.spaceship&&(console.log("Updating spaceship button"),this.updateSpaceshipButton(t.spaceship.price,t.spaceship.level,t.spaceship.maxLevel,t.spaceship.canAfford))}e.rebirth&&(console.log("Updating rebirth button"),this.updateRebirthButton(e.rebirth.canRebirth,e.rebirth.prestigePoints)),e.ads&&(console.log("Updating ad button"),this.updateAdButton(e.ads.canWatch,e.ads.timeLeft,e.ads.hasActiveBoost)),console.log("Calling update callbacks, count:",this.updateCallbacks.length),this.updateCallbacks.forEach(t=>{typeof t=="function"&&t(e)})}addUpdateCallback(e){console.log("addUpdateCallback called with callback:",e),typeof e=="function"&&this.updateCallbacks.push(e)}removeUpdateCallback(e){console.log("removeUpdateCallback called with callback:",e);const t=this.updateCallbacks.indexOf(e);t>-1&&this.updateCallbacks.splice(t,1)}getElement(e){console.log("getElement called with elementKey:",e);const t=this.elements[e]||null;return console.log("getElement result:",t),t}isReady(){return console.log("isReady called, returning:",this.isInitialized),this.isInitialized}formatNumber(e){if(console.log("formatNumber called with:",e),isNaN(e)||e===null||e===void 0)return console.log("formatNumber returning 0 due to invalid input"),"0";if(e=Math.floor(e),console.log("formatNumber after Math.floor:",e),e<0){const s="-"+this.formatNumber(Math.abs(e));return console.log("formatNumber returning negative result:",s),s}if(e>=1e12){const s=(e/1e12).toFixed(2)+"T";return console.log("formatNumber returning T result:",s),s}if(e>=1e9){const s=(e/1e9).toFixed(2)+"B";return console.log("formatNumber returning B result:",s),s}if(e>=1e6){const s=(e/1e6).toFixed(2)+"M";return console.log("formatNumber returning M result:",s),s}if(e>=1e3){const s=(e/1e3).toFixed(1)+"K";return console.log("formatNumber returning K result:",s),s}const t=e.toString();return console.log("formatNumber returning base result:",t),t}cleanup(){console.log("cleanup called, old state:",{updateCallbacks:this.updateCallbacks.length,elements:Object.keys(this.elements),isInitialized:this.isInitialized}),this.updateCallbacks=[],this.elements={},this.isInitialized=!1,console.log("cleanup completed")}}class uo{constructor(){this.container=null,this.notifications=[],this.maxNotifications=5,this.defaultDuration=3e3,this.isInitialized=!1}init(){return console.log("NotificationSystem init called"),this.createContainer(),this.isInitialized=!0,console.log("NotificationSystem initialized"),!0}createContainer(){console.log("createContainer called"),this.container=document.getElementById("notification-container"),console.log("Existing container:",this.container),this.container?console.log("Using existing container"):(console.log("Creating new notification container"),this.container=document.createElement("div"),this.container.id="notification-container",this.container.style.cssText=`
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                pointer-events: none;
                max-width: 300px;
            `,document.body.appendChild(this.container),console.log("New container created and appended to body"))}show(e,t="info",s=null){if(console.log("show called with message:",e,"type:",t,"duration:",s),!this.isInitialized)return console.warn("NotificationSystem not initialized"),null;const i=this.createNotification(e,t,s);return this.addNotification(i),console.log("Notification added with id:",i.id),i.id}createNotification(e,t,s){console.log("createNotification called with message:",e,"type:",t,"duration:",s);const i="notification-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);console.log("Generated notification id:",i);const o=document.createElement("div");o.id=i,o.className=`notification notification-${t}`,o.textContent=e,console.log("Notification element created with class:",o.className);const r=`
            margin-bottom: 10px;
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: all 0.3s ease;
            pointer-events: auto;
            cursor: pointer;
            max-width: 100%;
            word-wrap: break-word;
        `,a={success:"background: linear-gradient(135deg, #4CAF50, #45a049);",error:"background: linear-gradient(135deg, #f44336, #d32f2f);",warning:"background: linear-gradient(135deg, #ff9800, #f57c00);",info:"background: linear-gradient(135deg, #2196F3, #1976D2);"};o.style.cssText=r+(a[t]||a.info),console.log("Notification styles applied");const l=this.getIcon(t);console.log("Icon for type",t,":",l),l&&(o.innerHTML=`<span style="margin-right: 8px;">${l}</span>${e}`,console.log("Icon added to notification")),o.addEventListener("click",()=>{console.log("Notification clicked, removing notification with id:",i),this.removeNotification(i)}),console.log("Click event listener added");const c={id:i,element:o,type:t,message:e,duration:s||this.defaultDuration,createdAt:Date.now()};return console.log("Notification data created:",c),c}getIcon(e){console.log("getIcon called with type:",e);const t={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"},s=t[e]||t.info;return console.log("getIcon result for type",e,":",s),s}addNotification(e){for(console.log("addNotification called with notification:",e);this.notifications.length>=this.maxNotifications;){const t=this.notifications.shift();console.log("Removing oldest notification:",t.id),this.removeNotificationElement(t.id)}this.notifications.push(e),console.log("Notification added to notifications array, new length:",this.notifications.length),this.container.appendChild(e.element),console.log("Notification element appended to container"),requestAnimationFrame(()=>{console.log("Animating notification appearance for id:",e.id),e.element.style.transform="translateX(0)"}),e.duration>0&&(console.log("Setting timeout to remove notification in",e.duration,"ms"),setTimeout(()=>{console.log("Timeout expired, removing notification:",e.id),this.removeNotification(e.id)},e.duration))}removeNotification(e){console.log("removeNotification called with id:",e);const t=this.notifications.find(s=>s.id===e);if(console.log("Found notification:",t),!t){console.log("Notification not found, returning");return}console.log("Animating notification disappearance for id:",e),t.element.style.transform="translateX(100%)",t.element.style.opacity="0",setTimeout(()=>{console.log("Timeout expired, removing notification element:",e),this.removeNotificationElement(e)},300)}removeNotificationElement(e){console.log("removeNotificationElement called with id:",e);const t=this.notifications.findIndex(s=>s.id===e);if(console.log("Found notification index:",t),t>-1){const s=this.notifications[t];console.log("Removing notification element from DOM:",s),s.element&&s.element.parentNode&&(s.element.parentNode.removeChild(s.element),console.log("Notification element removed from DOM")),this.notifications.splice(t,1),console.log("Notification removed from notifications array, new length:",this.notifications.length)}else console.log("Notification not found in array")}clearAll(){console.log("clearAll called, current notifications count:",this.notifications.length),this.notifications.forEach(e=>{console.log("Removing notification element from DOM:",e.id),e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element)}),this.notifications=[],console.log("All notifications cleared")}success(e,t){console.log("success called with message:",e,"duration:",t);const s=this.show(e,"success",t);return console.log("success result:",s),s}error(e,t){console.log("error called with message:",e,"duration:",t);const s=this.show(e,"error",t);return console.log("error result:",s),s}warning(e,t){console.log("warning called with message:",e,"duration:",t);const s=this.show(e,"warning",t);return console.log("warning result:",s),s}info(e,t){console.log("info called with message:",e,"duration:",t);const s=this.show(e,"info",t);return console.log("info result:",s),s}setMaxNotifications(e){console.log("setMaxNotifications called with max:",e),this.maxNotifications=Math.max(1,e),console.log("maxNotifications set to:",this.maxNotifications)}setDefaultDuration(e){console.log("setDefaultDuration called with duration:",e),this.defaultDuration=Math.max(1e3,e),console.log("defaultDuration set to:",this.defaultDuration)}getActiveNotifications(){console.log("getActiveNotifications called, current notifications count:",this.notifications.length);const e=this.notifications.map(t=>({id:t.id,type:t.type,message:t.message,createdAt:t.createdAt}));return console.log("getActiveNotifications result:",e),e}isReady(){return console.log("isReady called, returning:",this.isInitialized),this.isInitialized}cleanup(){console.log("cleanup called"),this.clearAll(),this.container&&this.container.parentNode&&(console.log("Removing container from DOM"),this.container.parentNode.removeChild(this.container)),this.container=null,this.isInitialized=!1,console.log("NotificationSystem cleaned up")}}class ho{constructor(){this.panels=new Map,this.activePanels=new Set,this.eventListeners=[],this.isInitialized=!1}init(){return this.registerPanels(),this.bindGlobalEvents(),this.isInitialized=!0,console.log("PanelManager initialized"),!0}registerPanels(){[{id:"settings",selector:".settings-panel",triggerSelector:"#settings-btn",closeOnOutsideClick:!0},{id:"map",selector:".map-panel",triggerSelector:"#map-btn",closeOnOutsideClick:!0},{id:"shop",selector:".shop-panel",triggerSelector:"#shop-btn",closeOnOutsideClick:!0},{id:"friends",selector:".friends-panel",triggerSelector:"#friends-btn",closeOnOutsideClick:!0}].forEach(t=>{this.registerPanel(t)})}registerPanel(e){const t={id:e.id,element:document.querySelector(e.selector),trigger:document.querySelector(e.triggerSelector),closeOnOutsideClick:e.closeOnOutsideClick||!1,isVisible:!1,callbacks:{onShow:null,onHide:null,onToggle:null}};if(!t.element)return console.warn(`Panel element not found: ${e.selector}`),!1;t.trigger&&this.addEventListener(t.trigger,"click",i=>{i.stopPropagation(),this.togglePanel(e.id)});const s=t.element.querySelector(".close-btn, #close-"+e.id);return s&&(this.addEventListener(s,"click",i=>{i.stopPropagation(),this.hidePanel(e.id)}),console.log(`Close button found for panel: ${e.id}`)),this.panels.set(e.id,t),console.log(`Panel registered: ${e.id}`),!0}showPanel(e){const t=this.panels.get(e);return!t||t.isVisible?!1:(this.hideAllPanels(),t.element.classList.add("panel-visible"),t.isVisible=!0,this.activePanels.add(e),e==="map"&&setTimeout(()=>{this.updateMapDisplay(),this.updateSystemsDisplay()},100),t.callbacks.onShow&&t.callbacks.onShow(t),console.log(`Panel shown: ${e}`),!0)}hidePanel(e){const t=this.panels.get(e);return!t||!t.isVisible?!1:(t.element.classList.remove("panel-visible"),t.isVisible=!1,this.activePanels.delete(e),t.callbacks.onHide&&t.callbacks.onHide(t),console.log(`Panel hidden: ${e}`),!0)}togglePanel(e){const t=this.panels.get(e);if(!t)return!1;const s=t.isVisible;return s?this.hidePanel(e):this.showPanel(e),t.callbacks.onToggle&&t.callbacks.onToggle(t,!s),!0}hideAllPanels(){this.activePanels.forEach(e=>{this.hidePanel(e)})}isPanelVisible(e){const t=this.panels.get(e);return t?t.isVisible:!1}getActivePanels(){return Array.from(this.activePanels)}setPanelCallbacks(e,t){const s=this.panels.get(e);return s?(t.onShow&&(s.callbacks.onShow=t.onShow),t.onHide&&(s.callbacks.onHide=t.onHide),t.onToggle&&(s.callbacks.onToggle=t.onToggle),!0):!1}bindGlobalEvents(){const e=t=>{if(this.activePanels.size===0)return;const s=Array.from(this.activePanels).some(r=>{const a=this.panels.get(r);return a&&a.element&&a.element.contains(t.target)}),i=Array.from(this.panels.values()).some(r=>r.trigger&&r.trigger.contains(t.target)),o=t.target.closest(".action-btn, .settings-btn, .map-btn, .shop-btn, .friends-btn, .buy-planet-btn, .close-btn");!s&&!i&&!o&&this.hideAllPanels()};document.addEventListener("click",e,!0),this.eventListeners.push({element:document,event:"click",handler:e}),this.addEventListener(document,"keydown",t=>{t.key==="Escape"&&this.hideAllPanels()})}initTabs(){this.initTabGroup(".shop-tab",".shop-tab-content","shop"),this.initTabGroup(".map-tab",".map-tab-content","map")}initTabGroup(e,t,s){const i=document.querySelectorAll(e),o=document.querySelectorAll(t);i.forEach(r=>{this.addEventListener(r,"click",()=>{const a=r.dataset.tab;i.forEach(c=>c.classList.remove("active")),o.forEach(c=>c.classList.remove("active")),r.classList.add("active");const l=document.getElementById(`${a}-tab`);l&&l.classList.add("active"),console.log(`Tab activated: ${s}/${a}`),this.handleTabChange(s,a)})})}handleTabChange(e,t){switch(e){case"map":t==="systems"?this.updateSystemsDisplay():t==="planets"&&this.updateMapDisplay();break}}updateSystemsDisplay(){console.log("Updating systems display...");const e=document.getElementById("systems-tab");if(e&&window.game&&window.game.prestigeSystem){const t=window.game.prestigeSystem.getUnlockedSystems(),s=window.game.prestigeSystem.currentSystem;let i='<div class="systems-grid">';const o={solar:"–°–æ–ª–Ω–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",alpha_centauri:"–ê–ª—å—Ñ–∞ –¶–µ–Ω—Ç–∞–≤—Ä–∞",vega:"–°–∏—Å—Ç–µ–º–∞ –í–µ–≥–∏"};t.forEach(r=>{const a=r===s;i+=`
                    <div class="system-item ${a?"active":""}" data-system="${r}">
                        <h3>${o[r]||r}</h3>
                        <p>${a?"–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞":"–î–æ—Å—Ç—É–ø–Ω–∞"}</p>
                    </div>
                `}),i+="</div>",e.innerHTML=i}}updateMapDisplay(){console.log("Updating map display...");const e=document.getElementById("planets-tab");if(e&&window.game&&window.game.planetSystem){const t=window.game.planetSystem.getMapData();let s='<div class="planets-grid">';t.forEach(i=>{const o=i.unlocked?i.current?"current":"unlocked":"locked",r=i.unlocked?"–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞":`${this.formatNumber(i.price)} –º–æ–Ω–µ—Ç`;s+=`
                    <div class="planet-item ${o}" data-planet="${i.id}">
                        <div class="planet-image">
                            ${i.image?`<img src="${i.image}" alt="${i.name}">`:"ü™ê"}
                        </div>
                        <div class="planet-info">
                            <h3>${i.name}</h3>
                            <p>${i.description}</p>
                            <div class="planet-stats">
                                <span class="boost">–ë—É—Å—Ç: x${i.boost}</span>
                                <span class="price">${r}</span>
                            </div>
                            ${i.unlocked?"":`<button class="buy-planet-btn" data-planet="${i.id}" data-price="${i.price}">–ö—É–ø–∏—Ç—å</button>`}
                        </div>
                    </div>
                `}),s+="</div>",e.innerHTML=s,this.bindPlanetBuyButtons()}}bindPlanetBuyButtons(){document.querySelectorAll(".buy-planet-btn").forEach(t=>{t.addEventListener("click",s=>{s.stopPropagation();const i=t.dataset.planet,o=parseInt(t.dataset.price);window.game&&window.game.buyPlanetFromMap&&(window.game.buyPlanetFromMap(i,o),setTimeout(()=>this.updateMapDisplay(),100))})})}formatNumber(e){return isNaN(e)||e===null||e===void 0?"0":(e=Math.floor(e),e<0?"-"+this.formatNumber(Math.abs(e)):e>=1e12?(e/1e12).toFixed(2)+"T":e>=1e9?(e/1e9).toFixed(2)+"B":e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString())}addEventListener(e,t,s,i=!1){e&&(e.addEventListener(t,s,i),this.eventListeners.push({element:e,event:t,handler:s,options:i}))}getPanel(e){return this.panels.get(e)||null}getAllPanels(){return Array.from(this.panels.keys())}isReady(){return this.isInitialized}getStats(){return{totalPanels:this.panels.size,activePanels:this.activePanels.size,panelList:Array.from(this.panels.keys()),activePanelList:Array.from(this.activePanels),eventListeners:this.eventListeners.length}}cleanup(){this.eventListeners.forEach(({element:e,event:t,handler:s,options:i})=>{e.removeEventListener(t,s,i||!1)}),this.eventListeners=[],this.hideAllPanels(),this.panels.clear(),this.activePanels.clear(),this.isInitialized=!1,console.log("PanelManager cleaned up")}}class go{constructor(){this.saveKey="planetClickerSave",this.autoSaveInterval=null,this.autoSaveDelay=3e4,this.isAutoSaveEnabled=!0,this.saveCallbacks=[],this.loadCallbacks=[]}saveGame(e){try{const t={version:"1.0.0",timestamp:Date.now(),data:e},s=JSON.stringify(t);return localStorage.setItem(this.saveKey,s),console.log("Game saved successfully"),this.saveCallbacks.forEach(i=>{typeof i=="function"&&i(t)}),!0}catch(t){return console.error("Error saving game:",t),!1}}loadGame(){try{const e=localStorage.getItem(this.saveKey);if(!e)return console.log("No save data found"),null;const t=JSON.parse(e);return this.isValidSaveData(t)?(console.log("Game loaded successfully"),this.loadCallbacks.forEach(s=>{typeof s=="function"&&s(t)}),t.data):(console.warn("Invalid save data format"),null)}catch(e){return console.error("Error loading game:",e),null}}isValidSaveData(e){return e&&typeof e=="object"&&e.version&&e.timestamp&&e.data}deleteSave(){try{return localStorage.removeItem(this.saveKey),console.log("Save data deleted"),!0}catch(e){return console.error("Error deleting save:",e),!1}}hasSaveData(){return localStorage.getItem(this.saveKey)!==null}getSaveInfo(){try{const e=localStorage.getItem(this.saveKey);if(!e)return null;const t=JSON.parse(e);return{version:t.version,timestamp:t.timestamp,date:new Date(t.timestamp),size:e.length}}catch(e){return console.error("Error getting save info:",e),null}}exportSave(){try{const e=localStorage.getItem(this.saveKey);if(!e)throw new Error("No save data to export");const t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),i=document.createElement("a");return i.href=s,i.download=`planet-clicker-save-${Date.now()}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),console.log("Save exported successfully"),!0}catch(e){return console.error("Error exporting save:",e),!1}}importSave(e){return new Promise((t,s)=>{if(!e){s(new Error("No file provided"));return}const i=new FileReader;i.onload=o=>{try{const r=JSON.parse(o.target.result);if(!this.isValidSaveData(r)){s(new Error("Invalid save file format"));return}localStorage.setItem(this.saveKey,o.target.result),console.log("Save imported successfully"),t(r.data)}catch(r){s(new Error("Error parsing save file: "+r.message))}},i.onerror=()=>{s(new Error("Error reading file"))},i.readAsText(e)})}startAutoSave(e){if(this.autoSaveInterval&&this.stopAutoSave(),!this.isAutoSaveEnabled){console.log("Auto-save is disabled");return}this.autoSaveInterval=setInterval(()=>{typeof e=="function"&&e()},this.autoSaveDelay),console.log(`Auto-save started (every ${this.autoSaveDelay/1e3} seconds)`)}stopAutoSave(){this.autoSaveInterval&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null,console.log("Auto-save stopped"))}setAutoSaveEnabled(e){this.isAutoSaveEnabled=e,e||this.stopAutoSave()}setAutoSaveDelay(e){this.autoSaveDelay=Math.max(5e3,e),this.autoSaveInterval&&(this.stopAutoSave(),console.log("Auto-save delay updated, restart required"))}addSaveCallback(e){typeof e=="function"&&this.saveCallbacks.push(e)}addLoadCallback(e){typeof e=="function"&&this.loadCallbacks.push(e)}removeSaveCallback(e){const t=this.saveCallbacks.indexOf(e);t>-1&&this.saveCallbacks.splice(t,1)}removeLoadCallback(e){const t=this.loadCallbacks.indexOf(e);t>-1&&this.loadCallbacks.splice(t,1)}getStats(){const e=this.getSaveInfo();return{hasSave:this.hasSaveData(),autoSaveEnabled:this.isAutoSaveEnabled,autoSaveDelay:this.autoSaveDelay,isAutoSaveRunning:!!this.autoSaveInterval,saveInfo:e,callbacksCount:{save:this.saveCallbacks.length,load:this.loadCallbacks.length}}}cleanup(){this.stopAutoSave(),this.saveCallbacks=[],this.loadCallbacks=[]}}class fo{constructor(){this.upgrades={},this.sprites=new Map,this.initializeUpgrades()}initializeUpgrades(){this.upgrades={click:{name:"–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞",description:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ —Å –∫–ª–∏–∫–∞ –Ω–∞ 1",basePrice:5,priceMultiplier:1.5,currentPrice:5,level:0,maxLevel:1/0,effect:e=>e},auto:{name:"–ê–≤—Ç–æ–∫–ª–∏–∫",description:"–î–æ–±–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–æ—Ö–æ–¥",basePrice:25,priceMultiplier:1.5,currentPrice:25,level:0,maxLevel:1/0,effect:e=>e},satellite:{name:"–°–ø—É—Ç–Ω–∏–∫",description:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–ª–∏–∫–æ–≤",basePrice:50,priceMultiplier:2,currentPrice:50,level:0,maxLevel:20,clickBonus:.5,effect:e=>1+e*.5},spaceship:{name:"–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å",description:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–æ—Ö–æ–¥",basePrice:200,priceMultiplier:2.5,currentPrice:200,level:0,maxLevel:10,autoBonus:2,effect:e=>e*2}}}getUpgrade(e){return this.upgrades[e]||null}getAllUpgrades(){return{...this.upgrades}}getUpgradePrice(e){const t=this.upgrades[e],s=t?t.currentPrice:0;return console.log("getUpgradePrice for",e,"- Level:",t==null?void 0:t.level,"Price:",s),s}getUpgradeLevel(e){const t=this.upgrades[e];return t?t.level:0}getMaxLevel(e){const t=this.upgrades[e];return t?t.maxLevel:0}canUpgrade(e,t){const s=this.upgrades[e];return s?t>=s.currentPrice&&s.level<s.maxLevel:!1}buyUpgrade(e,t){const s=this.upgrades[e];if(!s)return{success:!1,message:"–£–ª—É—á—à–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"};if(!this.canUpgrade(e,t))return s.level>=s.maxLevel?{success:!1,message:`${s.name} —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!`}:{success:!1,message:`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥! –ù—É–∂–Ω–æ ${this.formatNumber(s.currentPrice)}`};const i=s.currentPrice;console.log("Before upgrade - Level:",s.level,"Price:",s.currentPrice),s.level++;const o=s.currentPrice;return s.currentPrice=Math.floor(s.basePrice*Math.pow(s.priceMultiplier,s.level)),console.log("After upgrade - Level:",s.level,"Old price:",o,"New price:",s.currentPrice),{success:!0,message:`${s.name} —É–ª—É—á—à–µ–Ω! –£—Ä–æ–≤–µ–Ω—å ${s.level}`,cost:i,newLevel:s.level,newPrice:s.currentPrice}}getUpgradeEffect(e){const t=this.upgrades[e];if(!t||!t.effect)return 0;const s=t.effect(t.level);return console.log("getUpgradeEffect result for",e,":",s,"level:",t.level),s}getSatelliteClickBonus(){const e=this.upgrades.satellite;if(!e)return 1;const t=1+e.level*e.clickBonus;return console.log("getSatelliteClickBonus result:",t,"level:",e.level,"clickBonus:",e.clickBonus),t}getSpaceshipAutoBonus(){const e=this.upgrades.spaceship;if(!e)return 0;const t=e.level*e.autoBonus;return console.log("getSpaceshipAutoBonus result:",t,"level:",e.level,"autoBonus:",e.autoBonus),t}showUpgradeSprite(e){if(console.log(`Showing sprite for upgrade: ${e}`),this.sprites.has(e)){console.log(`Sprite for ${e} already exists`);return}const t=document.querySelector(".planet-area");if(!t){console.error("Planet container not found");return}const s=this.createUpgradeSprite(e);s&&(t.appendChild(s),this.sprites.set(e,s),this.animateSprite(s,e))}createUpgradeSprite(e){const s={satellite:{image:"./sprite/satellite.png",size:"40px",distance:"180px"},spaceship:{image:"./sprite/spacecraft.png",size:"50px",distance:"220px"}}[e];if(!s)return null;const i=document.createElement("div");return i.className=`upgrade-sprite ${e}-sprite`,i.style.cssText=`
            position: absolute;
            width: ${s.size};
            height: ${s.size};
            background-image: url('${s.image}');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            pointer-events: none;
            z-index: 5;
            opacity: 0.8;
        `,i}animateSprite(e,t){const s=this.upgrades[t];if(!s)return;let i=t==="satellite"?2:1.5;i+=s.level*.2;const o=t==="satellite"?180:220;let r=Math.random()*360;const a=()=>{r+=i;const l=Math.cos(r*Math.PI/180)*o,c=Math.sin(r*Math.PI/180)*o;e.style.left=`calc(50% + ${l}px - ${e.style.width}/2)`,e.style.top=`calc(50% + ${c}px - ${e.style.height}/2)`,requestAnimationFrame(a)};a()}removeUpgradeSprite(e){const t=this.sprites.get(e);t&&t.parentNode&&(t.parentNode.removeChild(t),this.sprites.delete(e))}updateSprites(){Object.keys(this.upgrades).forEach(e=>{this.upgrades[e].level>0&&(e==="satellite"||e==="spaceship")&&(this.sprites.has(e)||this.showUpgradeSprite(e))})}getUpgradeStats(){const e={};return Object.keys(this.upgrades).forEach(t=>{const s=this.upgrades[t];e[t]={level:s.level,maxLevel:s.maxLevel,currentPrice:s.currentPrice,effect:this.getUpgradeEffect(t),isMaxed:s.level>=s.maxLevel}}),e}saveState(){const e={};return Object.keys(this.upgrades).forEach(t=>{const s=this.upgrades[t];e[t]={level:s.level,currentPrice:s.currentPrice}}),e}loadState(e){e&&(Object.keys(e).forEach(t=>{const s=e[t],i=this.upgrades[t];i&&s&&(i.level=s.level||0,i.currentPrice=s.currentPrice||i.basePrice)}),this.updateSprites())}reset(){this.sprites.forEach((e,t)=>{this.removeUpgradeSprite(t)}),Object.keys(this.upgrades).forEach(e=>{const t=this.upgrades[e];t.level=0,t.currentPrice=t.basePrice}),console.log("Upgrades reset")}formatNumber(e){return isNaN(e)||e===null||e===void 0?"0":(e=Math.floor(e),e<0?"-"+this.formatNumber(Math.abs(e)):e>=1e12?(e/1e12).toFixed(2)+"T":e>=1e9?(e/1e9).toFixed(2)+"B":e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString())}cleanup(){this.sprites.forEach((e,t)=>{this.removeUpgradeSprite(t)}),this.sprites.clear(),console.log("UpgradeManager cleaned up")}}class po{constructor(){console.log("GameCore constructor called"),console.log("Initializing game state"),this.gameState=new ro,console.log("Initializing planet manager"),this.planetManager=new no,console.log("Initializing upgrade manager"),this.upgradeManager=new fo,console.log("Initializing click handler"),this.clickHandler=new ao,console.log("Initializing auto clicker"),this.autoClicker=new lo,console.log("Initializing display manager"),this.displayManager=new co,console.log("Initializing notification system"),this.notificationSystem=new uo,console.log("Initializing panel manager"),this.panelManager=new ho,console.log("Initializing save manager"),this.saveManager=new go,console.log("Initializing external systems"),this.telegramSDK=new Mt,this.soundSystem=new Dt,this.prestigeSystem=new Rt,this.boostSystem=new jt,this.referralSystem=new It(this.telegramSDK),this.supabaseClient=new so,console.log("Initializing ad state"),this.adState={handler:null,isReady:!1,isLoading:!1,lastAttempt:0,cooldownTime:5e3,retryCount:0,maxRetries:3},console.log("Initializing intervals and timeouts"),this.intervals=[],this.timeouts=[],console.log("Starting game initialization"),this.init().catch(e=>{console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:",e)})}async init(){console.log("GameCore init called");try{console.log("Initializing systems"),await this.initializeSystems(),console.log("Loading game"),await this.loadGame(),console.log("Connecting systems"),this.connectSystems(),console.log("Starting game processes"),this.startGameProcesses(),console.log("Initializing UI"),this.initializeUI(),console.log("Creating user profile"),this.createUserProfile(),console.log("Initializing advertising"),setTimeout(()=>this.initAdvertising(),1e3),console.log("Setting up debug functions"),this.setupDebugFunctions(),console.log("Game initialized successfully")}catch(e){console.error("Failed to initialize game:",e),this.notificationSystem.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã")}}async initializeSystems(){console.log("Initializing systems..."),console.log("Initializing UI systems"),this.notificationSystem.init(),this.displayManager.init(),this.panelManager.init(),console.log("Initializing game systems"),await this.planetManager.init(),console.log("Connecting planet manager with prestige system"),this.planetManager.setPrestigeSystem(this.prestigeSystem),console.log("Systems initialized")}connectSystems(){console.log("Connecting systems..."),console.log("Setting up save callback"),this.saveManager.addSaveCallback(()=>{console.log("Save callback triggered")}),console.log("Setting up auto clicker callback"),this.autoClicker.setCallbacks({onTick:()=>this.processAutoClick()}),console.log("Systems connected")}startGameProcesses(){console.log("Starting game processes..."),console.log("Starting auto clicker"),this.autoClicker.start(),console.log("Starting auto save"),this.saveManager.startAutoSave(()=>this.saveGame()),console.log("Starting Supabase auto save"),this.startSupabaseAutoSave(),console.log("Game processes started")}initializeUI(){console.log("Initializing UI..."),console.log("Initializing click handler");const e=document.getElementById("planet-earth");console.log("Planet element for click handler:",e),this.clickHandler.init(e,t=>this.clickPlanet(t)),console.log("Binding button events"),this.bindButtonEvents(),console.log("Initializing tabs"),this.panelManager.initTabs(),console.log("Updating display"),this.updateDisplay(),console.log("UI initialized")}bindButtonEvents(){Object.entries({"buy-click":()=>this.buyUpgrade("click"),"buy-auto":()=>this.buyUpgrade("auto"),"buy-satellite":()=>this.buyUpgrade("satellite"),"buy-spaceship":()=>this.buyUpgrade("spaceship"),"watch-ad-btn":()=>this.watchAd(),"rebirth-btn":()=>this.performPrestige(),"settings-btn":()=>this.openSettings(),"map-btn":()=>this.openMap(),"shop-btn":()=>this.openShop(),"friends-btn":()=>this.openFriends()}).forEach(([i,o])=>{const r=document.getElementById(i);r&&r.addEventListener("click",o)});const t=document.getElementById("sound-toggle"),s=document.getElementById("music-toggle");t&&(t.checked=this.soundSystem.getSettings().soundEnabled,t.addEventListener("change",i=>{this.soundSystem.setSoundEnabled(i.target.checked)})),s&&(s.checked=this.soundSystem.getSettings().musicEnabled,s.addEventListener("change",i=>{this.soundSystem.setMusicEnabled(i.target.checked)}))}clickPlanet(e){console.log("clickPlanet called with event:",e),console.log("Calculating click value");const t=this.planetManager.getTotalPlanetBoost(),s=this.boostSystem.getClickMultiplier(),i=this.upgradeManager.getSatelliteClickBonus(),o=this.gameState.getClickValue(),r=Math.floor(o*t*s*i);if(console.log("Click calculation:",{baseClickValue:o,planetBoost:t,clickBoost:s,satelliteBonus:i,totalClickValue:r}),r<=0){console.error("Total click value is 0 or negative!",{baseClickValue:o,planetBoost:t,clickBoost:s,satelliteBonus:i,calculation:`${o} * ${t} * ${s} * ${i} = ${r}`});const l=1;console.log("Using fallback click value:",l),this.gameState.addMoney(l)}else console.log("Adding money from click:",r),this.gameState.addMoney(r);this.gameState.registerClick();const a=this.telegramSDK.getUserId();a&&(console.log("Adding referral earning for user:",a),this.referralSystem.addReferralEarning(a,r)),console.log("Playing click sound and effects"),this.soundSystem.playClickSound(),this.soundSystem.createClickEffect(),this.telegramSDK.hapticFeedback("impact","light"),this.planetManager.createClickEffect(e),this.planetManager.showMoneyPopup(e,r),console.log("Calling updateDisplay and saveGame"),this.updateDisplay(),this.saveGame()}processAutoClick(){console.log("processAutoClick called");const e=this.gameState.getAutoClickValue();if(console.log("Auto value:",e),e<=0){console.log("Auto value is 0 or less, skipping");return}const t=this.planetManager.getTotalPlanetBoost(),s=this.boostSystem.getAutoMultiplier(),i=Math.floor(e*t*s);console.log("Calculated totalAutoValue:",i,"from autoValue:",e,"planetBoost:",t,"autoBoost:",s),i>0&&(console.log("Adding money from auto click"),this.gameState.addMoney(i),this.updateDisplay())}buyUpgrade(e){if(console.log("buyUpgrade called with type:",e),this.clickHandler.isDebouncing()){console.log("Click handler is debouncing, skipping upgrade purchase");return}const t=this.upgradeManager.buyUpgrade(e,this.gameState.getMoney());if(console.log("Upgrade purchase result:",t),!t.success){console.log("Upgrade purchase failed:",t.message),this.soundSystem.playErrorSound(),this.telegramSDK.hapticFeedback("notification","error"),this.notificationSystem.error(t.message);return}switch(console.log("Spending money for upgrade, cost:",t.cost),this.gameState.spendMoney(t.cost),console.log("Applying upgrade effects for type:",e),e){case"click":console.log("Applying click upgrade effect"),this.gameState.setClickValue(this.gameState.getClickValue()+1);break;case"auto":console.log("Applying auto upgrade effect"),this.gameState.increaseBaseAutoClick(1);break;case"satellite":console.log("Applying satellite upgrade effect"),this.showUpgradeSprite("satellite");break;case"spaceship":console.log("Applying spaceship upgrade effect");const s=this.upgradeManager.getSpaceshipAutoBonus();this.gameState.setBaseAutoClickValue(s),this.showUpgradeSprite("spaceship");break}console.log("Updating boost state after upgrade"),this.updateBoostState(),console.log("Playing upgrade sound and haptic feedback"),this.soundSystem.playUpgradeSound(),this.telegramSDK.hapticFeedback("notification","success"),this.notificationSystem.success(t.message),console.log("Saving purchase to Supabase and updating display"),this.savePurchaseToSupabase(e+"_upgrade",1,t.cost),this.updateDisplay(),this.saveGame()}updateBoostState(){console.log("updateBoostState called");const e=this.planetManager.getTotalPlanetBoost(),t=this.boostSystem.getAutoMultiplier(),s=1+this.prestigeSystem.getPrestigeBonus();console.log("updateBoostState called with:",{planetBoost:e,autoBoost:t,prestigeBonus:s});const i=1+this.upgradeManager.getUpgradeEffect("click"),o=this.upgradeManager.getSatelliteClickBonus(),r=Math.floor(i*e*s*o);console.log("Calculated newClickValue:",{baseClick:i,planetBoost:e,prestigeBonus:s,satelliteBonus:o,newClickValue:r}),this.gameState.setClickValue(r);const a=this.upgradeManager.getUpgradeEffect("auto")+this.upgradeManager.getSpaceshipAutoBonus(),l=Math.floor(a*e*t*s);console.log("Calculated newAutoValue:",{baseAuto:a,planetBoost:e,autoBoost:t,prestigeBonus:s,newAutoValue:l}),this.gameState.setAutoClickValue(l),console.log("updateBoostState completed")}updateDisplay(){const e=this.gameState.getMoney();console.log("updateDisplay called with money:",e);const t={money:e,income:this.gameState.getAutoClickValue(),upgrades:{click:{price:this.upgradeManager.getUpgradePrice("click"),canAfford:this.upgradeManager.canUpgrade("click",this.gameState.getMoney())},auto:{price:this.upgradeManager.getUpgradePrice("auto"),canAfford:this.upgradeManager.canUpgrade("auto",this.gameState.getMoney())},satellite:{price:this.upgradeManager.getUpgradePrice("satellite"),level:this.upgradeManager.getUpgradeLevel("satellite"),maxLevel:this.upgradeManager.getMaxLevel("satellite"),canAfford:this.upgradeManager.canUpgrade("satellite",this.gameState.getMoney())},spaceship:{price:this.upgradeManager.getUpgradePrice("spaceship"),level:this.upgradeManager.getUpgradeLevel("spaceship"),maxLevel:this.upgradeManager.getMaxLevel("spaceship"),canAfford:this.upgradeManager.canUpgrade("spaceship",this.gameState.getMoney())}},rebirth:{canRebirth:this.prestigeSystem.canPrestige(this.gameState.getMoney()),prestigePoints:this.prestigeSystem.calculatePrestigePoints(this.gameState.getMoney())},ads:{canWatch:this.boostSystem.canWatchAd().canWatch,timeLeft:this.boostSystem.canWatchAd().timeLeft,hasActiveBoost:this.boostSystem.hasActiveAdBoost()},boost:{totalMultiplier:this.calculateTotalMultiplier(),hasActiveBoost:this.boostSystem.hasActiveAdBoost()}};this.displayManager.updateAll(t)}calculateTotalMultiplier(){const e=this.planetManager.getTotalPlanetBoost(),t=this.boostSystem.getClickMultiplier(),s=this.prestigeSystem.getPrestigeBonus(),i=this.upgradeManager.getSatelliteClickBonus(),o=e*t*s*i;return console.log("calculateTotalMultiplier:",{planetBoost:e,clickBoost:t,prestigeBonus:s,satelliteBonus:i,totalMultiplier:o}),o}saveGame(){console.log("saveGame called");const e={gameState:this.gameState.saveState(),planetSystem:this.planetManager.saveState(),upgradeSystem:this.upgradeManager.saveState(),prestigeSystem:this.prestigeSystem.savePrestigeData(),boostSystem:this.boostSystem.saveState(),soundSettings:this.soundSystem.getSettings()};console.log("Save data prepared:",e);const t=this.saveManager.saveGame(e);return console.log("Save game result:",t),t}async loadGame(){console.log("loadGame called");const e=this.saveManager.loadGame();console.log("Save data loaded:",e),e?(console.log("Loading saved game data"),e.gameState&&(console.log("Loading game state"),this.gameState.loadState(e.gameState)),e.planetSystem&&(console.log("Loading planet system"),this.planetManager.loadState(e.planetSystem)),e.upgradeSystem&&(console.log("Loading upgrade system"),this.upgradeManager.loadState(e.upgradeSystem)),e.prestigeSystem&&(console.log("Loading prestige system"),this.prestigeSystem.loadPrestigeData(e.prestigeSystem)),e.boostSystem&&(console.log("Loading boost system"),this.boostSystem.loadState(e.boostSystem)),e.soundSettings&&(console.log("Loading sound settings"),this.soundSystem.loadSettings(e.soundSettings)),console.log("Updating boost state after loading"),this.updateBoostState(),console.log("Game loaded successfully")):console.log("No save data found, starting new game")}performPrestige(){console.log("performPrestige called");const e=this.gameState.getMoney();console.log("Performing prestige with money:",e),this.prestigeSystem.performPrestige(e),console.log("Resetting game state"),this.gameState.reset(),console.log("Resetting planet manager"),this.planetManager.reset(),console.log("Resetting upgrade manager"),this.upgradeManager.reset(),console.log("Updating boost state and display after prestige"),this.updateBoostState(),this.updateDisplay(),this.saveGame(),this.notificationSystem.success("–ü—Ä–µ—Å—Ç–∏–∂ –≤—ã–ø–æ–ª–Ω–µ–Ω!")}initAdvertising(){console.log("Initializing advertising..."),console.log("Detecting ad SDK"),this.detectAdSDK(),console.log("Updating ad UI"),this.updateAdUI()}detectAdSDK(){console.log("detectAdSDK called");const e=[window.show_9701900,window.showAd,window.monetagAds];console.log("Checking for ad handlers:",e);for(const t of e)if(t&&typeof t=="function"){console.log("Ad SDK handler found:",t),this.adState.handler=t,this.adState.isReady=!0,console.log("Ad SDK detected");return}console.warn("Ad SDK not detected"),this.adState.isReady=!1}updateAdUI(){console.log("updateAdUI called"),console.log("Updating display for ad UI"),this.updateDisplay()}openSettings(){console.log("openSettings called"),this.panelManager.showPanel("settings")}openMap(){console.log("openMap called"),this.panelManager.showPanel("map")}openShop(){console.log("openShop called"),this.panelManager.showPanel("shop")}openFriends(){console.log("openFriends called"),this.panelManager.showPanel("friends")}createUserProfile(){console.log("Creating user profile...")}showUpgradeSprite(e){console.log("showUpgradeSprite called with type:",e),this.upgradeManager.showUpgradeSprite(e)}savePurchaseToSupabase(e,t,s){console.log("Saving purchase to Supabase:",e,t,s)}startSupabaseAutoSave(){console.log("Starting Supabase auto-save...")}watchAd(){if(console.log("watchAd called"),!this.adState.isReady||!this.adState.handler){console.log("Ad SDK not ready or handler not found"),this.notificationSystem.info("–†–µ–∫–ª–∞–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ!"),this.detectAdSDK();return}console.log("Checking if ad can be watched");const e=this.boostSystem.canWatchAd();if(!e.canWatch){console.log("Ad cannot be watched now, time left:",e.timeLeft),this.notificationSystem.warning(`–°–ª–µ–¥—É—é—â–∞—è —Ä–µ–∫–ª–∞–º–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ ${e.timeLeft} —Å–µ–∫`);return}if(this.boostSystem.hasActiveAdBoost()){console.log("Ad boost is already active"),this.notificationSystem.warning("–£ –≤–∞—Å —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω –±—É—Å—Ç –æ—Ç —Ä–µ–∫–ª–∞–º—ã!");return}console.log("Starting ad watch process"),this.adState.isLoading=!0,this.adState.lastAttempt=Date.now();try{console.log("Calling ad handler");const t=this.adState.handler();Promise.resolve(t).then(()=>{console.log("Ad watch success"),this.onAdSuccess()}).catch(s=>{console.log("Ad watch error:",s),this.onAdError(s)}).finally(()=>{console.log("Ad watch process completed"),this.adState.isLoading=!1})}catch(t){console.log("Ad watch exception:",t),this.onAdError(t),this.adState.isLoading=!1}}onAdSuccess(){console.log("onAdSuccess called");const e=this.boostSystem.applyAdBoost();console.log("Ad boost result:",e),e.success?(console.log("Ad boost applied successfully"),this.soundSystem.playBoostSound(),this.telegramSDK.hapticFeedback("notification","success"),this.updateBoostState(),this.notificationSystem.success("–ë—É—Å—Ç x2 –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 30 —Å–µ–∫—É–Ω–¥!")):(console.log("Ad boost failed:",e.message),this.notificationSystem.warning(e.message)),this.adState.retryCount=0,this.updateDisplay()}onAdError(e){console.log("onAdError called with error:",e),this.adState.retryCount++,console.log("Retry count incremented to:",this.adState.retryCount);let t="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–ª–∞–º—É";console.log("Default error message:",t),e.message&&(console.log("Error message found:",e.message),e.message.includes("Network")||e.message.includes("network")?(t="–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ",console.log("Network error detected, message:",t)):e.message.includes("timeout")?(t="–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–µ–∫–ª–æ",console.log("Timeout error detected, message:",t)):(e.message.includes("block")||e.message.includes("Block"))&&(t="–†–µ–∫–ª–∞–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞. –û—Ç–∫–ª—é—á–∏—Ç–µ AdBlock",console.log("Block error detected, message:",t))),console.log("Showing error notification with message:",t),this.notificationSystem.error(t),this.adState.retryCount>=this.adState.maxRetries&&(console.log("Max retries reached, setting cooldown"),this.adState.cooldownTime=3e4,this.notificationSystem.warning("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ"),setTimeout(()=>{console.log("Resetting retry count and cooldown time"),this.adState.retryCount=0,this.adState.cooldownTime=5e3,this.detectAdSDK()},6e4))}setupDebugFunctions(){console.log("setupDebugFunctions called"),window.gameDebug={addMoney:e=>{console.log("gameDebug.addMoney called with amount:",e),this.gameState.addMoney(e),this.updateDisplay(),console.log(`Added ${e} money. Total: ${this.gameState.getMoney()}`)},unlockPlanet:e=>{console.log("gameDebug.unlockPlanet called with planetId:",e),this.planetManager.unlockPlanet(e)?(this.updateBoostState(),this.updateDisplay(),console.log(`Unlocked planet: ${e}`)):console.log(`Failed to unlock planet: ${e}`)},showStats:()=>{console.log("gameDebug.showStats called"),console.log("Game Statistics:",this.gameState.getGameStatistics()),console.log("Upgrade Stats:",this.upgradeManager.getUpgradeStats()),console.log("Save Manager Stats:",this.saveManager.getStats()),console.log("Auto Clicker Stats:",this.autoClicker.getStats())},testPrestige:()=>{console.log("gameDebug.testPrestige called"),console.log("Testing prestige reset..."),console.log("Before prestige - Upgrade prices:"),console.log("Click:",this.upgradeManager.getUpgradePrice("click")),console.log("Auto:",this.upgradeManager.getUpgradePrice("auto")),console.log("Satellite:",this.upgradeManager.getUpgradePrice("satellite")),console.log("Spaceship:",this.upgradeManager.getUpgradePrice("spaceship")),this.performPrestige(),console.log("After prestige - Upgrade prices:"),console.log("Click:",this.upgradeManager.getUpgradePrice("click")),console.log("Auto:",this.upgradeManager.getUpgradePrice("auto")),console.log("Satellite:",this.upgradeManager.getUpgradePrice("satellite")),console.log("Spaceship:",this.upgradeManager.getUpgradePrice("spaceship"))}},console.log("Debug functions set up")}cleanup(){console.log("cleanup called"),console.log("Clearing intervals, count:",this.intervals.length),this.intervals.forEach(e=>clearInterval(e)),console.log("Clearing timeouts, count:",this.timeouts.length),this.timeouts.forEach(e=>clearTimeout(e)),console.log("Cleaning up click handler"),this.clickHandler.cleanup(),console.log("Cleaning up auto clicker"),this.autoClicker.cleanup(),console.log("Cleaning up upgrade manager"),this.upgradeManager.cleanup(),console.log("Cleaning up save manager"),this.saveManager.cleanup(),console.log("Cleaning up display manager"),this.displayManager.cleanup(),console.log("Cleaning up notification system"),this.notificationSystem.cleanup(),console.log("Cleaning up panel manager"),this.panelManager.cleanup(),console.log("GameCore cleaned up")}}class mo{constructor(){console.log("PlanetClicker constructor called"),this.gameCore=new po,this.setupDelegation()}setupDelegation(){Object.defineProperty(this,"money",{get:()=>this.gameCore.gameState.getMoney(),set:e=>this.gameCore.gameState.setMoney(e)}),Object.defineProperty(this,"clickValue",{get:()=>this.gameCore.gameState.getClickValue(),set:e=>this.gameCore.gameState.setClickValue(e)}),Object.defineProperty(this,"autoClickValue",{get:()=>this.gameCore.gameState.getAutoClickValue(),set:e=>this.gameCore.gameState.setAutoClickValue(e)}),this.planetSystem=this.gameCore.planetManager,this.telegramSDK=this.gameCore.telegramSDK,this.soundSystem=this.gameCore.soundSystem,this.prestigeSystem=this.gameCore.prestigeSystem,this.boostSystem=this.gameCore.boostSystem,this.referralSystem=this.gameCore.referralSystem,this.supabaseClient=this.gameCore.supabaseClient,this.updateDisplay=()=>this.gameCore.updateDisplay(),this.saveGame=()=>this.gameCore.saveGame(),this.buyUpgrade=e=>this.gameCore.buyUpgrade(e),this.clickPlanet=e=>this.gameCore.clickPlanet(e),this.showNotification=(e,t)=>this.gameCore.notificationSystem.show(e,t),this.formatNumber=e=>this.gameCore.gameState.formatNumber(e),this.performPrestige=()=>this.gameCore.performPrestige(),this.updateBoostState=()=>this.gameCore.updateBoostState(),this.openSettings=()=>this.gameCore.openSettings(),this.openMap=()=>this.gameCore.openMap(),this.openShop=()=>this.gameCore.openShop(),this.openFriends=()=>this.gameCore.openFriends(),this.watchAd=()=>this.gameCore.watchAd(),this.initAdvertising=()=>this.gameCore.initAdvertising(),this.detectAdSDK=()=>this.gameCore.detectAdSDK(),this.updateAdUI=()=>this.gameCore.updateAdUI(),Object.defineProperty(this,"adState",{get:()=>this.gameCore.adState})}getSatelliteClickBonus(){return this.gameCore.upgradeManager.getSatelliteClickBonus()}showUpgradeSprite(e){return this.gameCore.showUpgradeSprite(e)}savePurchaseToSupabase(e,t,s){return this.gameCore.savePurchaseToSupabase(e,t,s)}buyPlanetFromMap(e,t){const s=this.planetSystem.buyPlanet(e,this.money);s.success?(this.gameCore.gameState.spendMoney(s.cost),this.gameCore.updateBoostState(),this.gameCore.soundSystem.playUnlockSound(),this.gameCore.telegramSDK.hapticFeedback("notification","success"),this.showNotification(s.message,"success"),this.updateDisplay(),this.saveGame()):(this.gameCore.soundSystem.playErrorSound(),this.gameCore.telegramSDK.hapticFeedback("notification","error"),this.showNotification(s.message,"error"))}buyDonation(e){this.money>=e&&(this.gameCore.gameState.spendMoney(e),this.gameCore.soundSystem.playPurchaseSound(),this.gameCore.telegramSDK.hapticFeedback("notification","success"),this.showNotification(`–°–ø–∞—Å–∏–±–æ –∑–∞ –¥–æ–Ω–∞—Ç ${this.formatNumber(e)}!`,"success"),this.updateDisplay(),this.saveGame())}buyPermanentBoost(){console.log("buyPermanentBoost called - delegating to GameCore")}updatePermanentBoostUI(){console.log("updatePermanentBoostUI called")}updateRebirthButton(){console.log("updateRebirthButton called"),this.updateDisplay()}updateShopDisplay(){console.log("updateShopDisplay called"),this.updateDisplay()}updateSystemsDisplay(){console.log("updateSystemsDisplay called")}updateMapDisplay(){console.log("updateMapDisplay called")}hideAllPanels(){this.gameCore.panelManager.hideAllPanels()}showDonationEffect(){console.log("Showing donation effect")}playSound(e){switch(e){case"boost":this.soundSystem.playBoostSound();break;default:console.log("Unknown sound type:",e)}}startAutoSave(){console.log("startAutoSave called - handled by GameCore")}startSupabaseAutoSave(){console.log("startSupabaseAutoSave called - handled by GameCore")}startAutoClicker(){console.log("startAutoClicker called - handled by GameCore")}loadGame(){console.log("loadGame - handled by GameCore")}initElements(){console.log("initElements - handled by GameCore")}bindEvents(){console.log("bindEvents - handled by GameCore")}initTabs(){console.log("initTabs - handled by GameCore")}createUserProfile(){console.log("createUserProfile - handled by GameCore")}}document.addEventListener("DOMContentLoaded",()=>{const n=new mo;window.game=n});
